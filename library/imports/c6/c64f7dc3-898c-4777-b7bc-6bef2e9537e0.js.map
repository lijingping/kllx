{"version":3,"sources":["assets/Script/GameLoad.js"],"names":["require","ShareSdk","Utils","window","cc","Class","Component","properties","m_n_logo","Node","m_loaded","m_l_text","Label","start","setDesignResolution","opacity","m_loaded2","self","_loadnum","wx","cloud","init","env","ENV","traceUser","success","res","runAction","sequence","fadeIn","callFunc","loadres","loadconfig","boo","sys","localStorage","getItem","guideboo","change","gold","console","log","MUSIC_SHOW_OFF","parseInt","setItem","GUIDE_LEVEL","CHANGE_BLOCK","setShareMenuEnabled","this$1","enterGame","tempFileURL","i","push","showLoading","title","loader","loadRes","err","obj","error","message","MAP_CONFIG","json","callFunction","name","result","event","userInfo","getSaveData","getdata","fail","showModal","content","Msg","showCancel","exitMiniProgram","MyPreloadScene","MENU_SCENE_NAME","completedCount","totalCount","item","string","Math","floor","sceneName","onProgress","onLoaded","undefined","info","director","_getSceneUuid","emit","Director","EVENT_BEFORE_SCENE_LOADING","load","uuid","type","asset","errorID","Error","hideLoading","loadScene"],"mappings":"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","sourceRoot":"/","sourcesContent":["require(\"./common/Wxlife\");\nvar ShareSdk = require(\"ShareSdk\");\nvar Utils = require(\"Utils\")\nwindow.Utils = Utils;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        m_n_logo: cc.Node,\n        m_loaded: false,\n        m_l_text: cc.Label,\n    },\n\n    start() {\n        Utils.setDesignResolution()\n        this.m_n_logo.opacity = 0;\n        this.m_loaded = false;\n        this.m_loaded2 = false;\n        let self = this;\n        this._loadnum = 0;\n        if (typeof (wx) != 'undefined') {\n            wx.cloud.init({\n                env: window.ENV,\n                traceUser: true,\n                success: (res) => {\n                    // console.log(\"init-\", res);\n                }\n            });\n        }\n        this.m_n_logo.runAction(cc.sequence(cc.fadeIn(0.2), cc.callFunc(() => {\n            self.loadres();\n            self.loadconfig();\n        })));\n        // cc.view.enableRetina(true);\n        let boo = cc.sys.localStorage.getItem('music');\n        let guideboo = cc.sys.localStorage.getItem('guideinfo');\n        let change = cc.sys.localStorage.getItem('change');\n        let gold = \n        console.log('guideboo', guideboo);\n        if (boo && boo != 'null') {\n            window.MUSIC_SHOW_OFF = parseInt(boo);\n        } else {\n            window.MUSIC_SHOW_OFF = 1;//默认开启\n            cc.sys.localStorage.setItem('music', '' + window.MUSIC_SHOW_OFF);\n        }\n\n        if (guideboo && guideboo != 'null') {\n            window.GUIDE_LEVEL = 1;\n        } else {\n            window.GUIDE_LEVEL = 0;\n            // cc.sys.localStorage.setItem('guideinfo', '1');\n        }\n        if (change && change != 'null') {\n            window.CHANGE_BLOCK = 1;\n        } else {\n            window.CHANGE_BLOCK = 0;\n        }\n        ShareSdk.setShareMenuEnabled(true, true);\n\n    },\n\n    loadconfig() {\n        let this$1 = this;\n        this$1._loadnum++;\n        this$1.enterGame();\n        // let remoteUrl = 'https://gifen-1253495541.cosgz.myqcloud.com/KillMonster/share_config.json';\n        // cc.loader.load(remoteUrl, function (err, netobj) {\n        //     if (err) {\n        //         console.error(err);\n        //         this$1._loadnum++;\n        //         this$1.enterGame();\n        //     } else {\n        //         window.BOX_SHARE = netobj.box_share;\n        //         window.SKIN_SHARE = netobj.skin_share;\n        //         window.MOVEGAME = netobj.moregame;\n        //         window.NEWYEAR = netobj.newyear;\n        //         console.warn(netobj);\n\n        //     }\n        // });\n    },\n\n    loadres() {\n        console.log(\"load res\");\n        let self = this;\n        window.tempFileURL = [];\n        for (let i = 1; i < 4; i++) {\n            window.tempFileURL.push(\"\");\n        }\n        if (typeof (wx) != 'undefined') {\n            wx.showLoading({\n                title: \"登录中...\"\n            });\n\n            // wx.cloud.getTempFileURL({\n            //     fileList: ['cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/game_config/level_config2.json',\n            //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share1.jpg',\n            //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share_normal.jpg',\n            //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share_result.jpg',\n            //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share_box.jpg'],\n            //     success: (res) => {\n            //         // console.log(res.fileList[0]);\n            //         window.tempFileURL = [];\n            //         let data = res.fileList[0];\n            //         for (let i = 1; i < res.fileList.length; i++) {\n            //             window.tempFileURL.push(res.fileList[i].tempFileURL);\n            //         }\n\n            //         if (data.status == 0) {\n            //             cc.loader.load(data.tempFileURL, function (err, netobj) {\n            //                 if (err) {\n            //                     cc.loader.loadRes('level_config2', function (err, obj) {\n            //                         if (err) {\n            //                             cc.error(err.message || err);\n            //                             return;\n            //                         }\n            //                         window.MAP_CONFIG = obj;\n            //                         window.dailypointdata = obj.daily_step;\n            //                         self._loadnum++;\n            //                         self.enterGame();\n            //                     });\n            //                 } else {\n            //                     window.MAP_CONFIG = netobj\n            //                     self._loadnum++;\n            //                     self.enterGame();\n            //                 }\n            //             });\n            //         } else {\n            //             cc.loader.loadRes('level_config2', function (err, obj) {\n            //                 if (err) {\n            //                     cc.error(err.message || err);\n            //                     return;\n            //                 }\n            //                 window.MAP_CONFIG = obj;\n            //                 self._loadnum++;\n            //                 self.enterGame();\n            //             });\n            //         }\n            //     },\n            //     fail: () => {\n            //         cc.loader.loadRes('level_config2', function (err, obj) {\n            //             if (err) {\n            //                 cc.error(err.message || err);\n            //                 return;\n            //             }\n            //             window.MAP_CONFIG = obj;\n            //             self._loadnum++;\n            //             self.enterGame();\n            //         });\n            //     }\n            // })\n            cc.loader.loadRes('level_config2', function (err, obj) {\n                if (err) {\n                    cc.error(err.message || err);\n                    return;\n                }\n\n                window.MAP_CONFIG = obj.json;\n                self._loadnum++;\n                self.enterGame();\n            });\n            //登录\n            wx.cloud.callFunction({\n                // 云函数名称\n                name: 'login',\n                // 传给云函数的参数\n                success: function (res) {\n                    console.log(res.result.event.userInfo);\n                    window.userInfo = res.result.event.userInfo;\n                    Utils.getSaveData(res => {\n                        window.getdata = true;\n                        self._loadnum++;\n                        self.enterGame();\n                    })\n                },\n                fail: (err) => {\n                    console.error(err);\n                    wx.showModal({\n                        title: \"提示\",\n                        content: \"登录异常，请稍后重试:\" + err.Msg,\n                        showCancel: false,\n                        success: () => {\n                            wx.exitMiniProgram();\n                        }\n                    })\n                }\n            })\n        } else {\n            self._loadnum = 1;\n            cc.loader.loadRes('level_config2', function (err, obj) {\n                if (err) {\n                    cc.error(err.message || err);\n                    return;\n                }\n\n                window.MAP_CONFIG = obj.json;\n                self._loadnum++;\n                self.enterGame();\n            });\n        }\n\n        this.MyPreloadScene(window.MENU_SCENE_NAME, (completedCount, totalCount, item) => {\n            self.m_l_text.string = \"游戏加载中...\" + Math.floor((completedCount / totalCount) * 100) + \"%\";\n        }, () => {\n            console.log(\"preloadScene finish\");\n            self._loadnum++;\n            self.enterGame();\n        });\n\n        Utils.getSaveData(res => {\n            window.getdata = true;\n            self._loadnum++;\n            self.enterGame();\n        })\n    },\n\n    MyPreloadScene(sceneName, onProgress, onLoaded) {\n        if (onLoaded === undefined) {\n            onLoaded = onProgress;\n            onProgress = null;\n        }\n\n        var info = cc.director._getSceneUuid(sceneName);\n        if (info) {\n            cc.director.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING, sceneName);\n            cc.loader.load({ uuid: info.uuid, type: 'uuid' },\n                onProgress,\n                function (error, asset) {\n                    if (error) {\n                        cc.errorID(1210, sceneName, error.message);\n                    }\n                    if (onLoaded) {\n                        onLoaded(error, asset);\n                    }\n                });\n        }\n        else {\n            var error = 'Can not preload the scene \"' + sceneName + '\" because it is not in the build settings.';\n            onLoaded(new Error(error));\n            cc.error('preloadScene: ' + error);\n        }\n    },\n    enterGame: function () {\n        if (this._loadnum >= 4) {\n            if (typeof (wx) != 'undefined'){\n                wx.hideLoading();   \n            }\n            cc.director.loadScene(window.MENU_SCENE_NAME);\n        }\n    }\n});\n"]}