{"version":3,"sources":["assets/Script/common/GuideManager.js"],"names":["Utils","require","cc","Class","Component","properties","m_n_mask","Node","m_n_guide_circle","m_n_bubble1","m_n_bubble2","m_n_confirm","m_sp_maskbg","start","node","on","EventType","TOUCH_START","touchStart","TOUCH_END","touchEnd","showGuide","tag","index","window","GUIDE_LEVEL","m_cur_tag","m_cur_index","CONFIG_GUIDE","_guide_data","setGuideInfo","active","sys","localStorage","setItem","event","type","stopPropagation","GAME_CONTROL","vec","touch","getLocation","getTouchIndex","target","_confirm","showNextGuide","setTimeout","delaytime","onConfirmClick","SetSoundEffect","BUTTON_CLICK_MUSIC","data","dir","bubblenode","descnode","find","dirpos","width","descsize","height","getComponent","Label","string","desc","monnode","y","position","x","offsetY","Animation","play","getTargetGridInfo"],"mappings":"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","sourceRoot":"/","sourcesContent":["var Utils = require(\"Utils\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        m_n_mask: cc.Node,\n        m_n_guide_circle: cc.Node,\n        m_n_bubble1: cc.Node,\n        m_n_bubble2: cc.Node,\n        m_n_confirm: cc.Node,\n        m_sp_maskbg: cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start() {\n        this.node.on(cc.Node.EventType.TOUCH_START, this.touchStart, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.touchEnd, this);\n    },\n\n    showGuide(tag, index) {\n        // console.log(\"window.GUIDE_LEVEL\", window.GUIDE_LEVEL);\n        if (window.GUIDE_LEVEL >= tag) return;\n        // console.log('shoGuide', tag, index);\n        this.m_cur_tag = tag;\n        this.m_cur_index = index;\n        if (window.CONFIG_GUIDE[tag][index]) {\n            this._guide_data = window.CONFIG_GUIDE[tag][index];\n            this.setGuideInfo(this._guide_data);\n        } else {\n            this.node.active = false;\n            window.GUIDE_LEVEL += 1;\n            cc.sys.localStorage.setItem('guideinfo', '' + window.GUIDE_LEVEL);\n            return;\n        }\n        if (!this.node.active) this.node.active = true;\n    },\n\n    touchStart(event) {\n        if (this._guide_data.type == 2) {\n            event.stopPropagation();\n            return;\n        } else {\n            if (window.GAME_CONTROL) {\n                let vec = event.touch.getLocation();\n                let index = window.GAME_CONTROL.getTouchIndex(vec);\n                if (index != this._guide_data.target) {\n                    this._confirm = false;\n                    event.stopPropagation();\n                    return;\n                } else {\n                    this._confirm = true;\n                }\n            } else {\n                this.node.active = false;\n            }\n        }\n    },\n\n    touchEnd(event) {\n        if (this._guide_data.type != 2) {\n            if (this._confirm) {\n                this.showNextGuide();\n            }\n        }\n        this._confirm = false;\n    },\n\n    showNextGuide() {\n        this._guide_data.target = -2;\n        this._guide_data.type = -1;\n        setTimeout(() => {\n            this.m_cur_index += 1;\n            this.showGuide(this.m_cur_tag, this.m_cur_index);\n        }, window.CONFIG_GUIDE[this.m_cur_tag][this.m_cur_index].delaytime);\n    },\n\n    onConfirmClick() {\n        Utils.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);\n        this.showNextGuide();\n    },\n\n    setGuideInfo(data) {\n        this.m_n_bubble1.active = (data.dir == 1);\n        this.m_n_bubble2.active = (data.dir == 2);\n        let bubblenode = data.dir == 1 ? this.m_n_bubble1 : this.m_n_bubble2;\n        let descnode = cc.find(\"l_guide_desc\", bubblenode);\n        let dirpos = data.dir == 1 ? -1 : 1;\n        descnode.width = data.descsize[0];\n        descnode.height = data.descsize[1];\n        descnode.getComponent(cc.Label).string = data.desc;\n        bubblenode.width = data.descsize[0] + 100;\n        bubblenode.height = data.descsize[1] + 50;\n        let monnode = cc.find(\"sp_mon\", bubblenode);\n        monnode.y = bubblenode.height / 2;\n        if (typeof (data.target) === 'string') {//目标点\n            let node = cc.find(data.target);\n            this.m_n_mask.position = node.position;\n            this.m_n_mask.width = node.width + 10;\n            this.m_n_mask.height = node.height + 10;\n            bubblenode.x = this.m_n_mask.x + dirpos * this.m_n_mask.width / 2;\n            bubblenode.y = this.m_n_mask.y + this.m_n_mask.height / 2 + data.offsetY;\n            this.m_n_guide_circle.width = this.m_n_mask.width + 30;\n            this.m_n_guide_circle.height = this.m_n_mask.height + 30;\n            this.m_n_guide_circle.getComponent(cc.Animation).play();\n            this.m_n_guide_circle.position = this.m_n_mask.position;\n            this.m_sp_maskbg.x = -this.m_n_mask.x;\n            this.m_sp_maskbg.y = -this.m_n_mask.y;\n        } else if (typeof (data.target) === 'number') {\n            if (data.target == -1) {\n                this.m_n_mask.width = 0;\n                this.m_n_mask.height = 0;\n                this.m_n_guide_circle.width = 0;\n                bubblenode.y = 0;\n                bubblenode.x = 0;\n            } else {\n                if (window.GAME_CONTROL) {\n                    let node = window.GAME_CONTROL.getTargetGridInfo(data.target);\n                    this.m_n_mask.position = node.position;\n                    this.m_n_mask.width = node.width + 10;\n                    this.m_n_mask.height = node.height + 10;\n                    bubblenode.x = this.m_n_mask.x + dirpos * this.m_n_mask.width / 2;\n                    bubblenode.y = this.m_n_mask.y + this.m_n_mask.height / 2 + data.offsetY;\n                    this.m_n_guide_circle.width = this.m_n_mask.width + 30;\n                    this.m_n_guide_circle.height = this.m_n_mask.height + 30;\n                    this.m_n_guide_circle.getComponent(cc.Animation).play();\n                    this.m_n_guide_circle.position = this.m_n_mask.position;\n                    this.m_sp_maskbg.x = -this.m_n_mask.x;\n                    this.m_sp_maskbg.y = -this.m_n_mask.y;\n                }\n            }\n        }\n        if (data.type == 2) {\n            this.m_n_confirm.active = true;\n            this.m_n_confirm.x = bubblenode.x + dirpos * bubblenode.width / 2;\n            this.m_n_confirm.y = bubblenode.y - 40;\n        } else {\n            this.m_n_confirm.active = false;\n        }\n    },\n    // update (dt) {},\n});\n"]}