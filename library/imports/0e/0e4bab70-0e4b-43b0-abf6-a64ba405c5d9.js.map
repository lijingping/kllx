{"version":3,"sources":["assets/Script/common/shader/EffectCommon.js"],"names":["_default_vert","require","_default_vert_no_mvp","_wave","Utils","cc","Class","Component","properties","onLoad","self","parameters","time","mouse","x","y","resolution","wavewidth","node","on","Node","EventType","TOUCH_END","event","delta","touch","getLocation","convertToNodeSpace","getContentSize","width","height","showWave","_show_wave","_use","update","dt","_program","use","updateGLParameters","sys","isNative","glProgram_state","GLProgramState","getOrCreateWithGLProgram","setUniformFloat","setUniformVec2","setUniformLocationWith1f","_time","setUniformLocationWith2f","_mouse","GLProgram","log","initWithString","addAttribute","macro","ATTRIBUTE_NAME_POSITION","VERTEX_ATTRIB_POSITION","ATTRIBUTE_NAME_COLOR","VERTEX_ATTRIB_COLOR","ATTRIBUTE_NAME_TEX_COORD","VERTEX_ATTRIB_TEX_COORDS","link","updateUniforms","initWithVertexShaderByteArray","getUniformLocationForName","setProgram","_sgNode","program","setGLProgramState","setShaderProgram","children","i","length"],"mappings":"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","sourceRoot":"/","sourcesContent":["var _default_vert = require(\"ccShader_Default_Vert\");\nvar _default_vert_no_mvp = require(\"ccShader_Default_Vert_noMVP\");\nvar _wave = require(\"ccShader_wave\");\n\n\nvar Utils = require(\"Utils\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n    },\n\n    onLoad: function () {\n        var self = this;\n        this.parameters = {\n            time: 0.0,\n            mouse: {\n                x: 0.5,\n                y: 0.5,\n            },\n            resolution: {\n                x: 0.0,\n                y: 0.0,\n            },\n            wavewidth: 6 / 108,\n        };\n        this.node.on(cc.Node.EventType.TOUCH_END, function (event) {\n            let delta = event.touch.getLocation();\n            delta = this.node.convertToNodeSpace(delta);\n            this.parameters.mouse.x = delta.x / this.node.getContentSize().width;\n            this.parameters.mouse.y = delta.y / this.node.getContentSize().height;\n            // console.log(this.parameters.mouse);\n            this.parameters.time = 0.0;\n            this.parameters.wavewidth = 40 / this.node.getContentSize().width;\n            this.showWave();\n        }, this);\n        this._show_wave = false;\n        self._use();\n\n    },\n\n    showWave() {\n        this._show_wave = true;\n    },\n\n    update: function (dt) {\n        if (this._program && this._show_wave) {\n            this._program.use();\n            this.updateGLParameters(dt);\n            if (cc.sys.isNative) {\n                var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\n                glProgram_state.setUniformFloat(\"time\", this.parameters.time);\n                glProgram_state.setUniformVec2(\"mouse\", this.parameters.mouse);\n            } else {\n                // this._program.setUniformLocationWith2f(this._resolution, this.parameters.resolution.x, this.parameters.resolution.y);\n                this._program.setUniformLocationWith1f(this._time, this.parameters.time);\n                this._program.setUniformLocationWith2f(this._mouse, this.parameters.mouse.x, 1.0-this.parameters.mouse.y);\n            }\n        }\n    },\n    \n    updateGLParameters(dt) {\n        this.parameters.time += dt;\n        // console.log(this.parameters.time)\n        // if (this.parameters.time >= 0.1) this._show_wave = false;\n    },\n\n    _use: function () {\n        this._program = new cc.GLProgram();\n        if (cc.sys.isNative) {\n            cc.log(\"use native GLProgram\");\n            this._program.initWithString(_default_vert_no_mvp, _wave);\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\n\n            this._program.link();\n            this._program.updateUniforms();\n        } else {\n\n            this._program.initWithVertexShaderByteArray(_default_vert, _wave);\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\n            this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\n\n            this._program.link();\n            this._program.updateUniforms();\n        }\n\n        if (cc.sys.isNative) {\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(this._program);\n            glProgram_state.setUniformFloat(\"time\", this.parameters.time);\n            glProgram_state.setUniformVec2(\"mouse\", this.parameters.mouse);\n        } else {\n            this._time = this._program.getUniformLocationForName(\"time\");\n            this._mouse = this._program.getUniformLocationForName(\"mouse\");\n            this._program.setUniformLocationWith1f(this._time, this.parameters.time);\n            this._program.setUniformLocationWith2f(this._mouse, this.parameters.mouse.x, this.parameters.mouse.y);\n        }\n\n        this.setProgram(this.node._sgNode, this._program);\n    },\n\n    setProgram: function (node, program) {\n        if (cc.sys.isNative) {\n            var glProgram_state = cc.GLProgramState.getOrCreateWithGLProgram(program);\n            node.setGLProgramState(glProgram_state);\n        } else {\n            node.setShaderProgram(program);\n        }\n\n        var children = node.children;\n        if (!children)\n            return;\n\n        for (var i = 0; i < children.length; i++)\n            this.setProgram(children[i], program)\n    }\n\n});\n"]}