{"version":3,"sources":["assets/Script/common/launch.js"],"names":["ShareSdk","require","Utils","RankList","cc","Class","Component","properties","m_sp_rank_mask","Node","display","Sprite","rankCloseBtn","playGameBtn","groudGameBtn","start","tex","Texture2D","node","active","isShow","EVENT_LISTENER","on","window","GAME_RANK_LISTENER","rankUpdate","isshowtrue","onEnable","onDisable","SHOW_RES","onDestroy","off","query","group","ShowGroudRankClick","shareTicket","onClick","SetSoundEffect","BUTTON_CLICK_MUSIC","GAME_MENU","showAdBanner","showFriendList","onGroudBtnClick","shareAppMessage","title","imageUrl","tempFileURL","success","res","fail","err","complate","msg","onCloseClick","onPlayGameClick","director","loadScene","GAME_SCENE_NAME","_updaetSubDomainCanvas","initWithElement","sharedCanvas","handleLoadedTexture","spriteFrame","SpriteFrame","update","dt","wx","event","showGroupList"],"mappings":"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","sourceRoot":"/","sourcesContent":["// import Data from './Common_Data';\nvar ShareSdk = require(\"ShareSdk\");\nvar Utils = require(\"Utils\");\nvar RankList = require('RankList');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        m_sp_rank_mask: cc.Node,\n        display: cc.Sprite,        //刷新排行榜显示的sprite\n        rankCloseBtn: cc.Node,     //返回主视图按钮\n        playGameBtn: cc.Node,      //开始游戏按钮\n        groudGameBtn: cc.Node,     //查看群排行按钮\n    },\n\n    start() {\n        // this.isGroudBtn = true;\n\n        this.tex = new cc.Texture2D();\n        this.display.node.active = false;\n        this.m_sp_rank_mask.active = false;\n        this.isShow = false;\n        EVENT_LISTENER.on(window.GAME_RANK_LISTENER, this.rankUpdate, this);\n        this.isshowtrue = true;\n        this.rankUpdate();\n    },\n\n    onEnable() {\n        this.rankUpdate();\n    },\n\n\n    onDisable() {\n        window.SHOW_RES = null;\n    },\n\n    onDestroy() {\n        EVENT_LISTENER.off(window.GAME_RANK_LISTENER, this);\n    },\n\n    rankUpdate() {\n        if (window.SHOW_RES && window.SHOW_RES.query.group) {\n            this.ShowGroudRankClick({ query: window.SHOW_RES.query, shareTicket: window.SHOW_RES.shareTicket });\n            if (this.isshowtrue)\n                window.SHOW_RES = null;\n        }\n    },\n\n    //查看好友排行按键事件\n    onClick() {\n        Utils.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);\n        this.rankCloseBtn.active = true;\n        this.groudGameBtn.active = true;\n        this.isShow = true;\n        if(window.GAME_MENU) window.GAME_MENU.showAdBanner(false);\n        // console.log(\"点击，发消息给子域\");\n        this.display.node.active = this.isShow;\n        this.m_sp_rank_mask.active = this.isShow;\n        // var masScoreStr = window.INIT_GAME_SAVE_DATA.top_level;\n        // RankList.setScore(masScoreStr,\n        //     (info) => {\n        //         console.log(\"保存游戏信息成功！\", info);\n        //     },\n        //     () => {\n        //         console.log(\"保存游戏信息失败！\");\n        //     },\n        //     (info) => {\n        //         console.log(\"保存游戏信息已完成！\", info);\n        //     }\n        // );\n\n        RankList.showFriendList();\n    },\n    //查看群排行按键事件\n    onGroudBtnClick() {\n        Utils.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);\n        // Data.share(EChannelPrefix.grouprank, \"group=2\");\n        ShareSdk.shareAppMessage({\n            title: \"我已经消灭了N个怪兽了，你呢？快来看看排名\",\n            imageUrl: window.tempFileURL[1],\n            query: \"group=2\",\n            success: res => {\n\n            },\n            fail: err => {\n\n            },\n            complate: msg => {\n\n            },\n        });\n    },\n\n    //返回主视图事件\n    onCloseClick() {\n        Utils.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);\n        this.isShow = false;\n        this.display.node.active = false;\n        this.m_sp_rank_mask.active = this.isShow;\n        this.playGameBtn.active = false;\n        this.groudGameBtn.active = false;\n        this.rankCloseBtn.active = false;\n        if(window.GAME_MENU) window.GAME_MENU.showAdBanner(true);\n    },\n    //开始游戏按键\n    onPlayGameClick() {\n        Utils.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);\n        // console.log(\"===============onPlayGameClick================\");\n        this.isShow = false;\n        cc.director.loadScene(window.GAME_SCENE_NAME);\n    },\n    //刷新排行榜显示\n    _updaetSubDomainCanvas() {\n        if (!this.tex) {\n            return;\n        }\n        this.tex.initWithElement(sharedCanvas);\n        this.tex.handleLoadedTexture();\n        this.display.spriteFrame = new cc.SpriteFrame(this.tex);\n    },\n\n    update(dt) {\n        // this.ShowGroudRankClick();\n        if (typeof (wx) != \"undefined\")\n            this._updaetSubDomainCanvas();\n    },\n\n\n    ShowGroudRankClick(event) {\n        Utils.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);\n        if(window.GAME_MENU) window.GAME_MENU.showAdBanner(false);\n        if (event.query && event.shareTicket) {\n\n            // console.log(\"=============ShowGroudRankClick================\");\n            // var masScoreStr = window.INIT_GAME_SAVE_DATA.top;\n            // RankList.setScore(masScoreStr,\n            //     (info) => {\n            //         console.log(\"保存游戏信息成功！\", info);\n            //     },\n            //     () => {\n            //         console.log(\"保存游戏信息失败！\");\n            //     },\n            //     (info) => {\n            //         console.log(\"保存游戏信息已完成！\", info);\n            //     }\n            // );\n            RankList.showGroupList(event.shareTicket);\n            this.isShow = true;\n            this.display.node.active = this.isShow;\n            this.m_sp_rank_mask.active = this.isShow;\n            this.rankCloseBtn.active = true;\n            this.playGameBtn.active = false;\n            this.groudGameBtn.active = false;\n        }\n    },\n\n});"]}