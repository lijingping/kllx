{"version":3,"sources":["assets/Script/item/UseToolItem.js"],"names":["Utils","require","ShareSdk","cc","Class","Component","properties","m_sp_tool","Sprite","m_n_get","Node","_tag","m_sp_desclist","type","m_n_shareget","start","EVENT_LISTENER","on","window","ON_SHOW_BACK","onshowback","active","BOX_SHARE","firstshare","initToolInfo","tag","num","sp","onCloseClick","node","onUseClick","GAME_CONTROL","onUseStrong","onAdBtnClick","event","custom","wx","VersionToast","showToast","title","icon","image","duration","setTimeout","hideToast","info","getSystemInfoSync","SDKVersion","showAd","videoReward","self","m_videoAd","createRewardedVideoAd","adUnitId","onError","err","load","then","show","onClose","status","offClose","isEnded","undefined","showTipsText","Color","BLACK","INIT_GAME_SAVE_DATA","tool","showGetItem","updateToolsNum","time","_onshowback","SHARE_TIME","Common_CommonUtil","showShareFailTips","onGetClick","gold_num","WHITE","onDestroy","off","destroy","onShareGet","shareAppMessage","imageUrl","tempFileURL"],"mappings":"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","sourceRoot":"/","sourcesContent":["import Common_CommonUtil from '../common/Common_CommonUtil'\nvar Utils = require(\"Utils\");\nvar ShareSdk = require('ShareSdk');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        m_sp_tool: cc.Sprite,\n        m_n_get: cc.Node,\n        _tag: 0,\n        m_sp_desclist: { type: cc.Node, default: [] },\n        m_n_shareget: cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start() {\n        EVENT_LISTENER.on(window.ON_SHOW_BACK, this.onshowback, this);\n        this.m_n_shareget.active = window.BOX_SHARE && !window.firstshare;\n    },\n\n\n    initToolInfo(tag, num, sp) {\n        // console.log(tag, num)\n        this._tag = tag;\n        this.m_n_get.active = num <= 0;\n    },\n\n    onCloseClick() {\n        this.node.active = false;\n    },\n\n    onUseClick() {\n        if (this._tag == 0) {\n\n        } else if (this._tag == 1) {\n            if (window.GAME_CONTROL) {\n                window.GAME_CONTROL.onUseStrong();\n                this.onCloseClick();\n            }\n        }\n    },\n\n    onAdBtnClick(event, custom) {\n        if (typeof (wx) != 'undefined') {\n            let VersionToast = () => {\n                wx.showToast({\n                    title: \"微信版本过低，无法看广告\",\n                    icon: \"none\",\n                    image: \"\",\n                    duration: 0,\n                });\n                setTimeout(() => wx.hideToast(), 2000);\n            };\n            let info = wx.getSystemInfoSync();\n            if (info.SDKVersion >= '2.0.4') {\n                this.showAd(custom);\n            } else {\n                VersionToast();\n            }\n        } else {\n            // console.log('it is not wechat');\n            this.videoReward(custom);\n        }\n    },\n\n    showAd(custom) {\n        let self = this;\n        if (!this.m_videoAd) {\n            this.m_videoAd = wx.createRewardedVideoAd({\n                adUnitId: 'adunit-e573e466be94d7f5'\n            });\n        }\n        this.m_videoAd.onError(err => {\n\n        });\n\n        this.m_videoAd.load()\n            .then(() => {\n                self.m_videoAd.show();\n                self.m_videoAd.onClose((status) => {\n                    self.m_videoAd.offClose();\n                    if (status && status.isEnded || status === undefined) {\n                        self.videoReward(custom);\n                    } else {\n\n                    }\n                });\n            })\n            .catch(err => Utils.showTipsText(\"拉去视频广告失败，请稍候重试\", null, null, null, 60, cc.Color.BLACK, 1.2));\n    },\n\n    videoReward(custom) {\n        window.INIT_GAME_SAVE_DATA.tool[this._tag] += 1;\n        Utils.showGetItem(1, 0, null, 0, 0);\n        if (window.GAME_CONTROL) {\n            window.GAME_CONTROL.updateToolsNum();\n        }\n    },\n\n    onshowback(time) {\n        if (this._onshowback) {\n            if (time >= window.SHARE_TIME) {\n                window.firstshare = true;\n                this.m_n_shareget.active = window.BOX_SHARE && !window.firstshare;\n                this.videoReward();\n            } else {\n                Common_CommonUtil.showShareFailTips();\n            }\n            this._onshowback = false;\n        }\n    },\n\n    onGetClick() {\n        if (window.INIT_GAME_SAVE_DATA.gold_num >= 20) {\n            // Utils.showTipsText(\"购买成功\", null, 0, 0, 60, cc.Color.WHITE, );\n            Utils.showGetItem(1, 0, null, 0, 0);\n            window.INIT_GAME_SAVE_DATA.gold_num -= 20;\n            window.INIT_GAME_SAVE_DATA.tool[this._tag] += 1;\n            if (window.GAME_CONTROL) {\n                window.GAME_CONTROL.updateToolsNum();\n            }\n        } else {\n            Utils.showTipsText(\"金币不足\", null, 0, 0, 60, cc.Color.WHITE);\n        }\n    },\n\n    onDestroy() {\n        EVENT_LISTENER.off(window.ON_SHOW_BACK, this);\n        if (this.m_videoAd) {\n            this.m_videoAd.destroy();\n            this.m_videoAd = null;\n        }\n    },\n\n    onShareGet() {\n        this._onshowback = true;\n        ShareSdk.shareAppMessage({\n            title: \"快扶着这个炸弹，要爆啦！要爆啦！\",\n            imageUrl: window.tempFileURL[3],\n        });\n    }\n    // update (dt) {},\n});\n"]}