
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/GameLoad.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'c64f73DiYxHd7e8a+8ulTfg', 'GameLoad');
// Script/GameLoad.js

"use strict";

require("./common/Wxlife");

var ShareSdk = require("ShareSdk");

var Utils = require("Utils");

window.Utils = Utils;
cc.Class({
  "extends": cc.Component,
  properties: {
    m_n_logo: cc.Node,
    m_loaded: false,
    m_l_text: cc.Label
  },
  start: function start() {
    Utils.setDesignResolution();
    this.m_n_logo.opacity = 0;
    this.m_loaded = false;
    this.m_loaded2 = false;
    var self = this;
    this._loadnum = 0;

    if (typeof wx != 'undefined') {
      wx.cloud.init({
        env: window.ENV,
        traceUser: true,
        success: function success(res) {// console.log("init-", res);
        }
      });
    }

    this.m_n_logo.runAction(cc.sequence(cc.fadeIn(0.2), cc.callFunc(function () {
      self.loadres();
      self.loadconfig();
    }))); // cc.view.enableRetina(true);

    var boo = cc.sys.localStorage.getItem('music');
    var guideboo = cc.sys.localStorage.getItem('guideinfo');
    var change = cc.sys.localStorage.getItem('change');
    var gold = console.log('guideboo', guideboo);

    if (boo && boo != 'null') {
      window.MUSIC_SHOW_OFF = parseInt(boo);
    } else {
      window.MUSIC_SHOW_OFF = 1; //默认开启

      cc.sys.localStorage.setItem('music', '' + window.MUSIC_SHOW_OFF);
    }

    if (guideboo && guideboo != 'null') {
      window.GUIDE_LEVEL = 1;
    } else {
      window.GUIDE_LEVEL = 0; // cc.sys.localStorage.setItem('guideinfo', '1');
    }

    if (change && change != 'null') {
      window.CHANGE_BLOCK = 1;
    } else {
      window.CHANGE_BLOCK = 0;
    }

    ShareSdk.setShareMenuEnabled(true, true);
  },
  loadconfig: function loadconfig() {
    var this$1 = this;
    this$1._loadnum++;
    this$1.enterGame(); // let remoteUrl = 'https://gifen-1253495541.cosgz.myqcloud.com/KillMonster/share_config.json';
    // cc.loader.load(remoteUrl, function (err, netobj) {
    //     if (err) {
    //         console.error(err);
    //         this$1._loadnum++;
    //         this$1.enterGame();
    //     } else {
    //         window.BOX_SHARE = netobj.box_share;
    //         window.SKIN_SHARE = netobj.skin_share;
    //         window.MOVEGAME = netobj.moregame;
    //         window.NEWYEAR = netobj.newyear;
    //         console.warn(netobj);
    //     }
    // });
  },
  loadres: function loadres() {
    console.log("load res");
    var self = this;
    window.tempFileURL = [];

    for (var i = 1; i < 4; i++) {
      window.tempFileURL.push("");
    }

    if (typeof wx != 'undefined') {
      wx.showLoading({
        title: "登录中..."
      }); // wx.cloud.getTempFileURL({
      //     fileList: ['cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/game_config/level_config2.json',
      //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share1.jpg',
      //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share_normal.jpg',
      //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share_result.jpg',
      //         'cloud://killmonster-test-df9a23.603e-killmonster-test-df9a23/share_templates/share_box.jpg'],
      //     success: (res) => {
      //         // console.log(res.fileList[0]);
      //         window.tempFileURL = [];
      //         let data = res.fileList[0];
      //         for (let i = 1; i < res.fileList.length; i++) {
      //             window.tempFileURL.push(res.fileList[i].tempFileURL);
      //         }
      //         if (data.status == 0) {
      //             cc.loader.load(data.tempFileURL, function (err, netobj) {
      //                 if (err) {
      //                     cc.loader.loadRes('level_config2', function (err, obj) {
      //                         if (err) {
      //                             cc.error(err.message || err);
      //                             return;
      //                         }
      //                         window.MAP_CONFIG = obj;
      //                         window.dailypointdata = obj.daily_step;
      //                         self._loadnum++;
      //                         self.enterGame();
      //                     });
      //                 } else {
      //                     window.MAP_CONFIG = netobj
      //                     self._loadnum++;
      //                     self.enterGame();
      //                 }
      //             });
      //         } else {
      //             cc.loader.loadRes('level_config2', function (err, obj) {
      //                 if (err) {
      //                     cc.error(err.message || err);
      //                     return;
      //                 }
      //                 window.MAP_CONFIG = obj;
      //                 self._loadnum++;
      //                 self.enterGame();
      //             });
      //         }
      //     },
      //     fail: () => {
      //         cc.loader.loadRes('level_config2', function (err, obj) {
      //             if (err) {
      //                 cc.error(err.message || err);
      //                 return;
      //             }
      //             window.MAP_CONFIG = obj;
      //             self._loadnum++;
      //             self.enterGame();
      //         });
      //     }
      // })

      cc.loader.loadRes('level_config2', function (err, obj) {
        if (err) {
          cc.error(err.message || err);
          return;
        }

        window.MAP_CONFIG = obj.json;
        self._loadnum++;
        self.enterGame();
      }); //登录

      wx.cloud.callFunction({
        // 云函数名称
        name: 'login',
        // 传给云函数的参数
        success: function success(res) {
          console.log(res.result.event.userInfo);
          window.userInfo = res.result.event.userInfo;
          Utils.getSaveData(function (res) {
            window.getdata = true;
            self._loadnum++;
            self.enterGame();
          });
        },
        fail: function fail(err) {
          console.error(err);
          wx.showModal({
            title: "提示",
            content: "登录异常，请稍后重试:" + err.Msg,
            showCancel: false,
            success: function success() {
              wx.exitMiniProgram();
            }
          });
        }
      });
    } else {
      self._loadnum = 1;
      cc.loader.loadRes('level_config2', function (err, obj) {
        if (err) {
          cc.error(err.message || err);
          return;
        }

        window.MAP_CONFIG = obj.json;
        self._loadnum++;
        self.enterGame();
      });
    }

    this.MyPreloadScene(window.MENU_SCENE_NAME, function (completedCount, totalCount, item) {
      self.m_l_text.string = "游戏加载中..." + Math.floor(completedCount / totalCount * 100) + "%";
    }, function () {
      console.log("preloadScene finish");
      self._loadnum++;
      self.enterGame();
    });
    Utils.getSaveData(function (res) {
      window.getdata = true;
      self._loadnum++;
      self.enterGame();
    });
  },
  MyPreloadScene: function MyPreloadScene(sceneName, onProgress, onLoaded) {
    if (onLoaded === undefined) {
      onLoaded = onProgress;
      onProgress = null;
    }

    var info = cc.director._getSceneUuid(sceneName);

    if (info) {
      cc.director.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING, sceneName);
      cc.loader.load({
        uuid: info.uuid,
        type: 'uuid'
      }, onProgress, function (error, asset) {
        if (error) {
          cc.errorID(1210, sceneName, error.message);
        }

        if (onLoaded) {
          onLoaded(error, asset);
        }
      });
    } else {
      var error = 'Can not preload the scene "' + sceneName + '" because it is not in the build settings.';
      onLoaded(new Error(error));
      cc.error('preloadScene: ' + error);
    }
  },
  enterGame: function enterGame() {
    if (this._loadnum >= 4) {
      if (typeof wx != 'undefined') {
        wx.hideLoading();
      }

      cc.director.loadScene(window.MENU_SCENE_NAME);
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvR2FtZUxvYWQuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsIlNoYXJlU2RrIiwiVXRpbHMiLCJ3aW5kb3ciLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsIm1fbl9sb2dvIiwiTm9kZSIsIm1fbG9hZGVkIiwibV9sX3RleHQiLCJMYWJlbCIsInN0YXJ0Iiwic2V0RGVzaWduUmVzb2x1dGlvbiIsIm9wYWNpdHkiLCJtX2xvYWRlZDIiLCJzZWxmIiwiX2xvYWRudW0iLCJ3eCIsImNsb3VkIiwiaW5pdCIsImVudiIsIkVOViIsInRyYWNlVXNlciIsInN1Y2Nlc3MiLCJyZXMiLCJydW5BY3Rpb24iLCJzZXF1ZW5jZSIsImZhZGVJbiIsImNhbGxGdW5jIiwibG9hZHJlcyIsImxvYWRjb25maWciLCJib28iLCJzeXMiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiZ3VpZGVib28iLCJjaGFuZ2UiLCJnb2xkIiwiY29uc29sZSIsImxvZyIsIk1VU0lDX1NIT1dfT0ZGIiwicGFyc2VJbnQiLCJzZXRJdGVtIiwiR1VJREVfTEVWRUwiLCJDSEFOR0VfQkxPQ0siLCJzZXRTaGFyZU1lbnVFbmFibGVkIiwidGhpcyQxIiwiZW50ZXJHYW1lIiwidGVtcEZpbGVVUkwiLCJpIiwicHVzaCIsInNob3dMb2FkaW5nIiwidGl0bGUiLCJsb2FkZXIiLCJsb2FkUmVzIiwiZXJyIiwib2JqIiwiZXJyb3IiLCJtZXNzYWdlIiwiTUFQX0NPTkZJRyIsImpzb24iLCJjYWxsRnVuY3Rpb24iLCJuYW1lIiwicmVzdWx0IiwiZXZlbnQiLCJ1c2VySW5mbyIsImdldFNhdmVEYXRhIiwiZ2V0ZGF0YSIsImZhaWwiLCJzaG93TW9kYWwiLCJjb250ZW50IiwiTXNnIiwic2hvd0NhbmNlbCIsImV4aXRNaW5pUHJvZ3JhbSIsIk15UHJlbG9hZFNjZW5lIiwiTUVOVV9TQ0VORV9OQU1FIiwiY29tcGxldGVkQ291bnQiLCJ0b3RhbENvdW50IiwiaXRlbSIsInN0cmluZyIsIk1hdGgiLCJmbG9vciIsInNjZW5lTmFtZSIsIm9uUHJvZ3Jlc3MiLCJvbkxvYWRlZCIsInVuZGVmaW5lZCIsImluZm8iLCJkaXJlY3RvciIsIl9nZXRTY2VuZVV1aWQiLCJlbWl0IiwiRGlyZWN0b3IiLCJFVkVOVF9CRUZPUkVfU0NFTkVfTE9BRElORyIsImxvYWQiLCJ1dWlkIiwidHlwZSIsImFzc2V0IiwiZXJyb3JJRCIsIkVycm9yIiwiaGlkZUxvYWRpbmciLCJsb2FkU2NlbmUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLE9BQU8sQ0FBQyxpQkFBRCxDQUFQOztBQUNBLElBQUlDLFFBQVEsR0FBR0QsT0FBTyxDQUFDLFVBQUQsQ0FBdEI7O0FBQ0EsSUFBSUUsS0FBSyxHQUFHRixPQUFPLENBQUMsT0FBRCxDQUFuQjs7QUFDQUcsTUFBTSxDQUFDRCxLQUFQLEdBQWVBLEtBQWY7QUFFQUUsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFHTEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1JDLElBQUFBLFFBQVEsRUFBRUosRUFBRSxDQUFDSyxJQURMO0FBRVJDLElBQUFBLFFBQVEsRUFBRSxLQUZGO0FBR1JDLElBQUFBLFFBQVEsRUFBRVAsRUFBRSxDQUFDUTtBQUhMLEdBSFA7QUFTTEMsRUFBQUEsS0FUSyxtQkFTRztBQUNKWCxJQUFBQSxLQUFLLENBQUNZLG1CQUFOO0FBQ0EsU0FBS04sUUFBTCxDQUFjTyxPQUFkLEdBQXdCLENBQXhCO0FBQ0EsU0FBS0wsUUFBTCxHQUFnQixLQUFoQjtBQUNBLFNBQUtNLFNBQUwsR0FBaUIsS0FBakI7QUFDQSxRQUFJQyxJQUFJLEdBQUcsSUFBWDtBQUNBLFNBQUtDLFFBQUwsR0FBZ0IsQ0FBaEI7O0FBQ0EsUUFBSSxPQUFRQyxFQUFSLElBQWUsV0FBbkIsRUFBZ0M7QUFDNUJBLE1BQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTQyxJQUFULENBQWM7QUFDVkMsUUFBQUEsR0FBRyxFQUFFbkIs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RSxDQUFDbUQsTUFBSCxDQUFVdUMsSUFBVixDQUFlO0FBQUVDLFFBQUFBLElBQUksRUFBRVAsSUFBSSxDQUFDTyxJQUFiO0FBQW1CQyxRQUFBQSxJQUFJLEVBQUU7QUFBekIsT0FBZixFQUNJWCxVQURKLEVBRUksVUFBVTFCLEtBQVYsRUFBaUJzQyxLQUFqQixFQUF3QjtBQUNwQixZQUFJdEMsS0FBSixFQUFXO0FBQ1B2RCxVQUFBQSxFQUFFLENBQUM4RixPQUFILENBQVcsSUFBWCxFQUFpQmQsU0FBakIsRUFBNEJ6QixLQUFLLENBQUNDLE9BQWxDO0FBQ0g7O0FBQ0QsWUFBSTBCLFFBQUosRUFBYztBQUNWQSxVQUFBQSxRQUFRLENBQUMzQixLQUFELEVBQVFzQyxLQUFSLENBQVI7QUFDSDtBQUNKLE9BVEw7QUFVSCxLQVpELE1BYUs7QUFDRCxVQUFJdEMsS0FBSyxHQUFHLGdDQUFnQ3lCLFNBQWhDLEdBQTRDLDRDQUF4RDtBQUNBRSxNQUFBQSxRQUFRLENBQUMsSUFBSWEsS0FBSixDQUFVeEMsS0FBVixDQUFELENBQVI7QUFDQXZELE1BQUFBLEVBQUUsQ0FBQ3VELEtBQUgsQ0FBUyxtQkFBbUJBLEtBQTVCO0FBQ0g7QUFDSixHQTdPSTtBQThPTFYsRUFBQUEsU0FBUyxFQUFFLHFCQUFZO0FBQ25CLFFBQUksS0FBSy9CLFFBQUwsSUFBaUIsQ0FBckIsRUFBd0I7QUFDcEIsVUFBSSxPQUFRQyxFQUFSLElBQWUsV0FBbkIsRUFBK0I7QUFDM0JBLFFBQUFBLEVBQUUsQ0FBQ2lGLFdBQUg7QUFDSDs7QUFDRGhHLE1BQUFBLEVBQUUsQ0FBQ3FGLFFBQUgsQ0FBWVksU0FBWixDQUFzQmxHLE1BQU0sQ0FBQzBFLGVBQTdCO0FBQ0g7QUFDSjtBQXJQSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKFwiLi9jb21tb24vV3hsaWZlXCIpO1xudmFyIFNoYXJlU2RrID0gcmVxdWlyZShcIlNoYXJlU2RrXCIpO1xudmFyIFV0aWxzID0gcmVxdWlyZShcIlV0aWxzXCIpXG53aW5kb3cuVXRpbHMgPSBVdGlscztcblxuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgbV9uX2xvZ286IGNjLk5vZGUsXG4gICAgICAgIG1fbG9hZGVkOiBmYWxzZSxcbiAgICAgICAgbV9sX3RleHQ6IGNjLkxhYmVsLFxuICAgIH0sXG5cbiAgICBzdGFydCgpIHtcbiAgICAgICAgVXRpbHMuc2V0RGVzaWduUmVzb2x1dGlvbigpXG4gICAgICAgIHRoaXMubV9uX2xvZ28ub3BhY2l0eSA9IDA7XG4gICAgICAgIHRoaXMubV9sb2FkZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5tX2xvYWRlZDIgPSBmYWxzZTtcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLl9sb2FkbnVtID0gMDtcbiAgICAgICAgaWYgKHR5cGVvZiAod3gpICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB3eC5jbG91ZC5pbml0KHtcbiAgICAgICAgICAgICAgICBlbnY6IHdpbmRvdy5FTlYsXG4gICAgICAgICAgICAgICAgdHJhY2VVc2VyOiB0cnVlLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJpbml0LVwiLCByZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubV9uX2xvZ28ucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLmZhZGVJbigwLjIpLCBjYy5jYWxsRnVuYygoKSA9PiB7XG4gICAgICAgICAgICBzZWxmLmxvYWRyZXMoKTtcbiAgICAgICAgICAgIHNlbGYubG9hZGNvbmZpZygpO1xuICAgICAgICB9KSkpO1xuICAgICAgICAvLyBjYy52aWV3LmVuYWJsZVJldGluYSh0cnVlKTtcbiAgICAgICAgbGV0IGJvbyA9IGNjLnN5cy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbXVzaWMnKTtcbiAgICAgICAgbGV0IGd1aWRlYm9vID0gY2Muc3lzLmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdndWlkZWluZm8nKTtcbiAgICAgICAgbGV0IGNoYW5nZSA9IGNjLnN5cy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY2hhbmdlJyk7XG4gICAgICAgIGxldCBnb2xkID0gXG4gICAgICAgIGNvbnNvbGUubG9nKCdndWlkZWJvbycsIGd1aWRlYm9vKTtcbiAgICAgICAgaWYgKGJvbyAmJiBib28gIT0gJ251bGwnKSB7XG4gICAgICAgICAgICB3aW5kb3cuTVVTSUNfU0hPV19PRkYgPSBwYXJzZUludChib28pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgd2luZG93Lk1VU0lDX1NIT1dfT0ZGID0gMTsvL+m7mOiupOW8gOWQr1xuICAgICAgICAgICAgY2Muc3lzLmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtdXNpYycsICcnICsgd2luZG93Lk1VU0lDX1NIT1dfT0ZGKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChndWlkZWJvbyAmJiBndWlkZWJvbyAhPSAnbnVsbCcpIHtcbiAgICAgICAgICAgIHdpbmRvdy5HVUlERV9MRVZFTCA9IDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3aW5kb3cuR1VJREVfTEVWRUwgPSAwO1xuICAgICAgICAgICAgLy8gY2Muc3lzLmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdndWlkZWluZm8nLCAnMScpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFuZ2UgJiYgY2hhbmdlICE9ICdudWxsJykge1xuICAgICAgICAgICAgd2luZG93LkNIQU5HRV9CTE9DSyA9IDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3aW5kb3cuQ0hBTkdFX0JMT0NLID0gMDtcbiAgICAgICAgfVxuICAgICAgICBTaGFyZVNkay5zZXRTaGFyZU1lbnVFbmFibGVkKHRydWUsIHRydWUpO1xuXG4gICAgfSxcblxuICAgIGxvYWRjb25maWcoKSB7XG4gICAgICAgIGxldCB0aGlzJDEgPSB0aGlzO1xuICAgICAgICB0aGlzJDEuX2xvYWRudW0rKztcbiAgICAgICAgdGhpcyQxLmVudGVyR2FtZSgpO1xuICAgICAgICAvLyBsZXQgcmVtb3RlVXJsID0gJ2h0dHBzOi8vZ2lmZW4tMTI1MzQ5NTU0MS5jb3Nnei5teXFjbG91ZC5jb20vS2lsbE1vbnN0ZXIvc2hhcmVfY29uZmlnLmpzb24nO1xuICAgICAgICAvLyBjYy5sb2FkZXIubG9hZChyZW1vdGVVcmwsIGZ1bmN0aW9uIChlcnIsIG5ldG9iaikge1xuICAgICAgICAvLyAgICAgaWYgKGVycikge1xuICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgLy8gICAgICAgICB0aGlzJDEuX2xvYWRudW0rKztcbiAgICAgICAgLy8gICAgICAgICB0aGlzJDEuZW50ZXJHYW1lKCk7XG4gICAgICAgIC8vICAgICB9IGVsc2Uge1xuICAgICAgICAvLyAgICAgICAgIHdpbmRvdy5CT1hfU0hBUkUgPSBuZXRvYmouYm94X3NoYXJlO1xuICAgICAgICAvLyAgICAgICAgIHdpbmRvdy5TS0lOX1NIQVJFID0gbmV0b2JqLnNraW5fc2hhcmU7XG4gICAgICAgIC8vICAgICAgICAgd2luZG93Lk1PVkVHQU1FID0gbmV0b2JqLm1vcmVnYW1lO1xuICAgICAgICAvLyAgICAgICAgIHdpbmRvdy5ORVdZRUFSID0gbmV0b2JqLm5ld3llYXI7XG4gICAgICAgIC8vICAgICAgICAgY29uc29sZS53YXJuKG5ldG9iaik7XG5cbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gfSk7XG4gICAgfSxcblxuICAgIGxvYWRyZXMoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwibG9hZCByZXNcIik7XG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgd2luZG93LnRlbXBGaWxlVVJMID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgNDsgaSsrKSB7XG4gICAgICAgICAgICB3aW5kb3cudGVtcEZpbGVVUkwucHVzaChcIlwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mICh3eCkgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHd4LnNob3dMb2FkaW5nKHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCLnmbvlvZXkuK0uLi5cIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHd4LmNsb3VkLmdldFRlbXBGaWxlVVJMKHtcbiAgICAgICAgICAgIC8vICAgICBmaWxlTGlzdDogWydjbG91ZDovL2tpbGxtb25zdGVyLXRlc3QtZGY5YTIzLjYwM2Uta2lsbG1vbnN0ZXItdGVzdC1kZjlhMjMvZ2FtZV9jb25maWcvbGV2ZWxfY29uZmlnMi5qc29uJyxcbiAgICAgICAgICAgIC8vICAgICAgICAgJ2Nsb3VkOi8va2lsbG1vbnN0ZXItdGVzdC1kZjlhMjMuNjAzZS1raWxsbW9uc3Rlci10ZXN0LWRmOWEyMy9zaGFyZV90ZW1wbGF0ZXMvc2hhcmUxLmpwZycsXG4gICAgICAgICAgICAvLyAgICAgICAgICdjbG91ZDovL2tpbGxtb25zdGVyLXRlc3QtZGY5YTIzLjYwM2Uta2lsbG1vbnN0ZXItdGVzdC1kZjlhMjMvc2hhcmVfdGVtcGxhdGVzL3NoYXJlX25vcm1hbC5qcGcnLFxuICAgICAgICAgICAgLy8gICAgICAgICAnY2xvdWQ6Ly9raWxsbW9uc3Rlci10ZXN0LWRmOWEyMy42MDNlLWtpbGxtb25zdGVyLXRlc3QtZGY5YTIzL3NoYXJlX3RlbXBsYXRlcy9zaGFyZV9yZXN1bHQuanBnJyxcbiAgICAgICAgICAgIC8vICAgICAgICAgJ2Nsb3VkOi8va2lsbG1vbnN0ZXItdGVzdC1kZjlhMjMuNjAzZS1raWxsbW9uc3Rlci10ZXN0LWRmOWEyMy9zaGFyZV90ZW1wbGF0ZXMvc2hhcmVfYm94LmpwZyddLFxuICAgICAgICAgICAgLy8gICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgICAgIC8vICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzLmZpbGVMaXN0WzBdKTtcbiAgICAgICAgICAgIC8vICAgICAgICAgd2luZG93LnRlbXBGaWxlVVJMID0gW107XG4gICAgICAgICAgICAvLyAgICAgICAgIGxldCBkYXRhID0gcmVzLmZpbGVMaXN0WzBdO1xuICAgICAgICAgICAgLy8gICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHJlcy5maWxlTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgd2luZG93LnRlbXBGaWxlVVJMLnB1c2gocmVzLmZpbGVMaXN0W2ldLnRlbXBGaWxlVVJMKTtcbiAgICAgICAgICAgIC8vICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PSAwKSB7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICBjYy5sb2FkZXIubG9hZChkYXRhLnRlbXBGaWxlVVJMLCBmdW5jdGlvbiAoZXJyLCBuZXRvYmopIHtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIGNjLmxvYWRlci5sb2FkUmVzKCdsZXZlbF9jb25maWcyJywgZnVuY3Rpb24gKGVyciwgb2JqKSB7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2MuZXJyb3IoZXJyLm1lc3NhZ2UgfHwgZXJyKTtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuTUFQX0NPTkZJRyA9IG9iajtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kYWlseXBvaW50ZGF0YSA9IG9iai5kYWlseV9zdGVwO1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9hZG51bSsrO1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5lbnRlckdhbWUoKTtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgd2luZG93Lk1BUF9DT05GSUcgPSBuZXRvYmpcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9hZG51bSsrO1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICBzZWxmLmVudGVyR2FtZSgpO1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgY2MubG9hZGVyLmxvYWRSZXMoJ2xldmVsX2NvbmZpZzInLCBmdW5jdGlvbiAoZXJyLCBvYmopIHtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIGNjLmVycm9yKGVyci5tZXNzYWdlIHx8IGVycik7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgd2luZG93Lk1BUF9DT05GSUcgPSBvYmo7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgc2VsZi5fbG9hZG51bSsrO1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIHNlbGYuZW50ZXJHYW1lKCk7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vICAgICAgICAgfVxuICAgICAgICAgICAgLy8gICAgIH0sXG4gICAgICAgICAgICAvLyAgICAgZmFpbDogKCkgPT4ge1xuICAgICAgICAgICAgLy8gICAgICAgICBjYy5sb2FkZXIubG9hZFJlcygnbGV2ZWxfY29uZmlnMicsIGZ1bmN0aW9uIChlcnIsIG9iaikge1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIGNjLmVycm9yKGVyci5tZXNzYWdlIHx8IGVycik7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgd2luZG93Lk1BUF9DT05GSUcgPSBvYmo7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICBzZWxmLl9sb2FkbnVtKys7XG4gICAgICAgICAgICAvLyAgICAgICAgICAgICBzZWxmLmVudGVyR2FtZSgpO1xuICAgICAgICAgICAgLy8gICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICAvLyB9KVxuICAgICAgICAgICAgY2MubG9hZGVyLmxvYWRSZXMoJ2xldmVsX2NvbmZpZzInLCBmdW5jdGlvbiAoZXJyLCBvYmopIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNjLmVycm9yKGVyci5tZXNzYWdlIHx8IGVycik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB3aW5kb3cuTUFQX0NPTkZJRyA9IG9iai5qc29uO1xuICAgICAgICAgICAgICAgIHNlbGYuX2xvYWRudW0rKztcbiAgICAgICAgICAgICAgICBzZWxmLmVudGVyR2FtZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvL+eZu+W9lVxuICAgICAgICAgICAgd3guY2xvdWQuY2FsbEZ1bmN0aW9uKHtcbiAgICAgICAgICAgICAgICAvLyDkupHlh73mlbDlkI3np7BcbiAgICAgICAgICAgICAgICBuYW1lOiAnbG9naW4nLFxuICAgICAgICAgICAgICAgIC8vIOS8oOe7meS6keWHveaVsOeahOWPguaVsFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzLnJlc3VsdC5ldmVudC51c2VySW5mbyk7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy51c2VySW5mbyA9IHJlcy5yZXN1bHQuZXZlbnQudXNlckluZm87XG4gICAgICAgICAgICAgICAgICAgIFV0aWxzLmdldFNhdmVEYXRhKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZ2V0ZGF0YSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9sb2FkbnVtKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmVudGVyR2FtZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmFpbDogKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCLmj5DnpLpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IFwi55m75b2V5byC5bi477yM6K+356iN5ZCO6YeN6K+VOlwiICsgZXJyLk1zZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWw6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHd4LmV4aXRNaW5pUHJvZ3JhbSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZWxmLl9sb2FkbnVtID0gMTtcbiAgICAgICAgICAgIGNjLmxvYWRlci5sb2FkUmVzKCdsZXZlbF9jb25maWcyJywgZnVuY3Rpb24gKGVyciwgb2JqKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjYy5lcnJvcihlcnIubWVzc2FnZSB8fCBlcnIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgd2luZG93Lk1BUF9DT05GSUcgPSBvYmouanNvbjtcbiAgICAgICAgICAgICAgICBzZWxmLl9sb2FkbnVtKys7XG4gICAgICAgICAgICAgICAgc2VsZi5lbnRlckdhbWUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5NeVByZWxvYWRTY2VuZSh3aW5kb3cuTUVOVV9TQ0VORV9OQU1FLCAoY29tcGxldGVkQ291bnQsIHRvdGFsQ291bnQsIGl0ZW0pID0+IHtcbiAgICAgICAgICAgIHNlbGYubV9sX3RleHQuc3RyaW5nID0gXCLmuLjmiI/liqDovb3kuK0uLi5cIiArIE1hdGguZmxvb3IoKGNvbXBsZXRlZENvdW50IC8gdG90YWxDb3VudCkgKiAxMDApICsgXCIlXCI7XG4gICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicHJlbG9hZFNjZW5lIGZpbmlzaFwiKTtcbiAgICAgICAgICAgIHNlbGYuX2xvYWRudW0rKztcbiAgICAgICAgICAgIHNlbGYuZW50ZXJHYW1lKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIFV0aWxzLmdldFNhdmVEYXRhKHJlcyA9PiB7XG4gICAgICAgICAgICB3aW5kb3cuZ2V0ZGF0YSA9IHRydWU7XG4gICAgICAgICAgICBzZWxmLl9sb2FkbnVtKys7XG4gICAgICAgICAgICBzZWxmLmVudGVyR2FtZSgpO1xuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICBNeVByZWxvYWRTY2VuZShzY2VuZU5hbWUsIG9uUHJvZ3Jlc3MsIG9uTG9hZGVkKSB7XG4gICAgICAgIGlmIChvbkxvYWRlZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBvbkxvYWRlZCA9IG9uUHJvZ3Jlc3M7XG4gICAgICAgICAgICBvblByb2dyZXNzID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBpbmZvID0gY2MuZGlyZWN0b3IuX2dldFNjZW5lVXVpZChzY2VuZU5hbWUpO1xuICAgICAgICBpZiAoaW5mbykge1xuICAgICAgICAgICAgY2MuZGlyZWN0b3IuZW1pdChjYy5EaXJlY3Rvci5FVkVOVF9CRUZPUkVfU0NFTkVfTE9BRElORywgc2NlbmVOYW1lKTtcbiAgICAgICAgICAgIGNjLmxvYWRlci5sb2FkKHsgdXVpZDogaW5mby51dWlkLCB0eXBlOiAndXVpZCcgfSxcbiAgICAgICAgICAgICAgICBvblByb2dyZXNzLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvciwgYXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5lcnJvcklEKDEyMTAsIHNjZW5lTmFtZSwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9uTG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkxvYWRlZChlcnJvciwgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgZXJyb3IgPSAnQ2FuIG5vdCBwcmVsb2FkIHRoZSBzY2VuZSBcIicgKyBzY2VuZU5hbWUgKyAnXCIgYmVjYXVzZSBpdCBpcyBub3QgaW4gdGhlIGJ1aWxkIHNldHRpbmdzLic7XG4gICAgICAgICAgICBvbkxvYWRlZChuZXcgRXJyb3IoZXJyb3IpKTtcbiAgICAgICAgICAgIGNjLmVycm9yKCdwcmVsb2FkU2NlbmU6ICcgKyBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGVudGVyR2FtZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fbG9hZG51bSA+PSA0KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mICh3eCkgIT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgICAgICAgIHd4LmhpZGVMb2FkaW5nKCk7ICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUod2luZG93Lk1FTlVfU0NFTkVfTkFNRSk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiJdfQ==