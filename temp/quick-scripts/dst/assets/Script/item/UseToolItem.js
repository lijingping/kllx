
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/item/UseToolItem.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'fb269ugEF5GsaQCUfIigkE3', 'UseToolItem');
// Script/item/UseToolItem.js

"use strict";

var _Common_CommonUtil = _interopRequireDefault(require("../common/Common_CommonUtil"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var Utils = require("Utils");

var ShareSdk = require('ShareSdk');

cc.Class({
  "extends": cc.Component,
  properties: {
    m_sp_tool: cc.Sprite,
    m_n_get: cc.Node,
    _tag: 0,
    m_sp_desclist: {
      type: cc.Node,
      "default": []
    },
    m_n_shareget: cc.Node
  },
  // LIFE-CYCLE CALLBACKS:
  // onLoad () {},
  start: function start() {
    EVENT_LISTENER.on(window.ON_SHOW_BACK, this.onshowback, this);
    this.m_n_shareget.active = window.BOX_SHARE && !window.firstshare;
  },
  initToolInfo: function initToolInfo(tag, num, sp) {
    // console.log(tag, num)
    this._tag = tag;
    this.m_n_get.active = num <= 0;
  },
  onCloseClick: function onCloseClick() {
    this.node.active = false;
  },
  onUseClick: function onUseClick() {
    if (this._tag == 0) {} else if (this._tag == 1) {
      if (window.GAME_CONTROL) {
        window.GAME_CONTROL.onUseStrong();
        this.onCloseClick();
      }
    }
  },
  onAdBtnClick: function onAdBtnClick(event, custom) {
    if (typeof wx != 'undefined') {
      var VersionToast = function VersionToast() {
        wx.showToast({
          title: "微信版本过低，无法看广告",
          icon: "none",
          image: "",
          duration: 0
        });
        setTimeout(function () {
          return wx.hideToast();
        }, 2000);
      };

      var info = wx.getSystemInfoSync();

      if (info.SDKVersion >= '2.0.4') {
        this.showAd(custom);
      } else {
        VersionToast();
      }
    } else {
      // console.log('it is not wechat');
      this.videoReward(custom);
    }
  },
  showAd: function showAd(custom) {
    var self = this;

    if (!this.m_videoAd) {
      this.m_videoAd = wx.createRewardedVideoAd({
        adUnitId: 'adunit-e573e466be94d7f5'
      });
    }

    this.m_videoAd.onError(function (err) {});
    this.m_videoAd.load().then(function () {
      self.m_videoAd.show();
      self.m_videoAd.onClose(function (status) {
        self.m_videoAd.offClose();

        if (status && status.isEnded || status === undefined) {
          self.videoReward(custom);
        } else {}
      });
    })["catch"](function (err) {
      return Utils.showTipsText("拉去视频广告失败，请稍候重试", null, null, null, 60, cc.Color.BLACK, 1.2);
    });
  },
  videoReward: function videoReward(custom) {
    window.INIT_GAME_SAVE_DATA.tool[this._tag] += 1;
    Utils.showGetItem(1, 0, null, 0, 0);

    if (window.GAME_CONTROL) {
      window.GAME_CONTROL.updateToolsNum();
    }
  },
  onshowback: function onshowback(time) {
    if (this._onshowback) {
      if (time >= window.SHARE_TIME) {
        window.firstshare = true;
        this.m_n_shareget.active = window.BOX_SHARE && !window.firstshare;
        this.videoReward();
      } else {
        _Common_CommonUtil["default"].showShareFailTips();
      }

      this._onshowback = false;
    }
  },
  onGetClick: function onGetClick() {
    if (window.INIT_GAME_SAVE_DATA.gold_num >= 20) {
      // Utils.showTipsText("购买成功", null, 0, 0, 60, cc.Color.WHITE, );
      Utils.showGetItem(1, 0, null, 0, 0);
      window.INIT_GAME_SAVE_DATA.gold_num -= 20;
      window.INIT_GAME_SAVE_DATA.tool[this._tag] += 1;

      if (window.GAME_CONTROL) {
        window.GAME_CONTROL.updateToolsNum();
      }
    } else {
      Utils.showTipsText("金币不足", null, 0, 0, 60, cc.Color.WHITE);
    }
  },
  onDestroy: function onDestroy() {
    EVENT_LISTENER.off(window.ON_SHOW_BACK, this);

    if (this.m_videoAd) {
      this.m_videoAd.destroy();
      this.m_videoAd = null;
    }
  },
  onShareGet: function onShareGet() {
    this._onshowback = true;
    ShareSdk.shareAppMessage({
      title: "快扶着这个炸弹，要爆啦！要爆啦！",
      imageUrl: window.tempFileURL[3]
    });
  } // update (dt) {},

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvaXRlbS9Vc2VUb29sSXRlbS5qcyJdLCJuYW1lcyI6WyJVdGlscyIsInJlcXVpcmUiLCJTaGFyZVNkayIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwibV9zcF90b29sIiwiU3ByaXRlIiwibV9uX2dldCIsIk5vZGUiLCJfdGFnIiwibV9zcF9kZXNjbGlzdCIsInR5cGUiLCJtX25fc2hhcmVnZXQiLCJzdGFydCIsIkVWRU5UX0xJU1RFTkVSIiwib24iLCJ3aW5kb3ciLCJPTl9TSE9XX0JBQ0siLCJvbnNob3diYWNrIiwiYWN0aXZlIiwiQk9YX1NIQVJFIiwiZmlyc3RzaGFyZSIsImluaXRUb29sSW5mbyIsInRhZyIsIm51bSIsInNwIiwib25DbG9zZUNsaWNrIiwibm9kZSIsIm9uVXNlQ2xpY2siLCJHQU1FX0NPTlRST0wiLCJvblVzZVN0cm9uZyIsIm9uQWRCdG5DbGljayIsImV2ZW50IiwiY3VzdG9tIiwid3giLCJWZXJzaW9uVG9hc3QiLCJzaG93VG9hc3QiLCJ0aXRsZSIsImljb24iLCJpbWFnZSIsImR1cmF0aW9uIiwic2V0VGltZW91dCIsImhpZGVUb2FzdCIsImluZm8iLCJnZXRTeXN0ZW1JbmZvU3luYyIsIlNES1ZlcnNpb24iLCJzaG93QWQiLCJ2aWRlb1Jld2FyZCIsInNlbGYiLCJtX3ZpZGVvQWQiLCJjcmVhdGVSZXdhcmRlZFZpZGVvQWQiLCJhZFVuaXRJZCIsIm9uRXJyb3IiLCJlcnIiLCJsb2FkIiwidGhlbiIsInNob3ciLCJvbkNsb3NlIiwic3RhdHVzIiwib2ZmQ2xvc2UiLCJpc0VuZGVkIiwidW5kZWZpbmVkIiwic2hvd1RpcHNUZXh0IiwiQ29sb3IiLCJCTEFDSyIsIklOSVRfR0FNRV9TQVZFX0RBVEEiLCJ0b29sIiwic2hvd0dldEl0ZW0iLCJ1cGRhdGVUb29sc051bSIsInRpbWUiLCJfb25zaG93YmFjayIsIlNIQVJFX1RJTUUiLCJDb21tb25fQ29tbW9uVXRpbCIsInNob3dTaGFyZUZhaWxUaXBzIiwib25HZXRDbGljayIsImdvbGRfbnVtIiwiV0hJVEUiLCJvbkRlc3Ryb3kiLCJvZmYiLCJkZXN0cm95Iiwib25TaGFyZUdldCIsInNoYXJlQXBwTWVzc2FnZSIsImltYWdlVXJsIiwidGVtcEZpbGVVUkwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7QUFDQSxJQUFJQSxLQUFLLEdBQUdDLE9BQU8sQ0FBQyxPQUFELENBQW5COztBQUNBLElBQUlDLFFBQVEsR0FBR0QsT0FBTyxDQUFDLFVBQUQsQ0FBdEI7O0FBQ0FFLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxTQUFTLEVBQUVKLEVBQUUsQ0FBQ0ssTUFETjtBQUVSQyxJQUFBQSxPQUFPLEVBQUVOLEVBQUUsQ0FBQ08sSUFGSjtBQUdSQyxJQUFBQSxJQUFJLEVBQUUsQ0FIRTtBQUlSQyxJQUFBQSxhQUFhLEVBQUU7QUFBRUMsTUFBQUEsSUFBSSxFQUFFVixFQUFFLENBQUNPLElBQVg7QUFBaUIsaUJBQVM7QUFBMUIsS0FKUDtBQUtSSSxJQUFBQSxZQUFZLEVBQUVYLEVBQUUsQ0FBQ087QUFMVCxHQUhQO0FBV0w7QUFFQTtBQUVBSyxFQUFBQSxLQWZLLG1CQWVHO0FBQ0pDLElBQUFBLGNBQWMsQ0FBQ0MsRUFBZixDQUFrQkMsTUFBTSxDQUFDQyxZQUF6QixFQUF1QyxLQUFLQyxVQUE1QyxFQUF3RCxJQUF4RDtBQUNBLFNBQUtOLFlBQUwsQ0FBa0JPLE1BQWxCLEdBQTJCSCxNQUFNLENBQUNJLFNBQVAsSUFBb0IsQ0FBQ0osTUFBTSxDQUFDSyxVQUF2RDtBQUNILEdBbEJJO0FBcUJMQyxFQUFBQSxZQXJCSyx3QkFxQlFDLEdBckJSLEVBcUJhQyxHQXJCYixFQXFCa0JDLEVBckJsQixFQXFCc0I7QUFDdkI7QUFDQSxTQUFLaEIsSUFBTCxHQUFZYyxHQUFaO0FBQ0EsU0FBS2hCLE9BQUwsQ0FBYVksTUFBYixHQUFzQkssR0FBRyxJQUFJLENBQTdCO0FBQ0gsR0F6Qkk7QUEyQkxFLEVBQUFBLFlBM0JLLDBCQTJCVTtBQUNYLFNBQUtDLElBQUwsQ0FBVVIsTUFBVixHQUFtQixLQUFuQjtBQUNILEdBN0JJO0FBK0JMUyxFQUFBQSxVQS9CSyx3QkErQlE7QUFDVCxRQUFJLEtBQUtuQixJQUFMLElBQWEsQ0FBakIsRUFBb0IsQ0FFbkIsQ0FGRCxNQUVPLElBQUksS0FBS0EsSUFBTCxJQUFhLENBQWpCLEVBQW9CO0FBQ3ZCLFVBQUlPLE1BQU0sQ0FBQ2EsWUFBWCxFQUF5QjtBQUNyQmIsUUFBQUEsTUFBTSxDQUFDYSxZQUFQLENBQW9CQyxXQUFwQjtBQUNBLGFBQUtKLFlBQUw7QUFDSDtBQUNKO0FBQ0osR0F4Q0k7QUEwQ0xLLEVBQUFBLFlBMUNLLHdCQTBDUUMsS0ExQ1IsRUEwQ2VDLE1BMUNmLEVBMEN1QjtBQUN4QixRQUFJLE9BQVFDLEVBQVIsSUFBZSxXQUFuQixFQUFnQztBQUM1QixVQUFJQyxZQUFZLEdBQUcsU0FBZkEsWUFBZSxHQUFNO0FBQ3JCRCxRQUFBQSxFQUFFLENBQUNFLFNBQUgsQ0FBYTtBQUNUQyxVQUFBQSxLQUFLLEVBQUUsY0FERTtBQUVUQyxVQUFBQSxJQUFJLEVBQUUsTUFGRztBQUdUQyxVQUFBQSxLQUFLLEVBQUUsRUFIRTtBQUlUQyxVQUFBQSxRQUFRLEVBQUU7QUFKRCxTQUFiO0FBTUFDLFFBQUFBLFVBQVUsQ0FBQztBQUFBLGlCQUFNUCxFQUFFLENBQUNRLFNBQUgsRUFBTjtBQUFBLFNBQUQsRUFBdUIsSUFBdkIsQ0FBVjtBQUNILE9BUkQ7O0FBU0EsVUFBSUMsSUFBSSxHQUFHVCxFQUFFLENBQUNVLGlCQUFILEVBQVg7O0FBQ0EsVUFBSUQsSUFBSSxDQUFDRSxVQUFMLElBQW1CLE9BQXZCLEVBQWdDO0FBQzVCLGFBQUtDLE1BQUwsQ0FBWWIsTUFBWjtBQUNILE9BRkQsTUFFTztBQUNIRSxRQUFBQSxZQUFZO0FBQ2Y7QUFDSixLQWhCRCxNQWdCTztBQUNIO0FBQ0EsV0FBS1ksV0FBTCxDQUFpQmQsTUFBakI7QUFDSDtBQUNKLEdBL0RJO0FBaUVMYSxFQUFBQSxNQWpFSyxrQkFpRUViLE1BakVGLEVBaUVVO0FBQ1gsUUFBSWUsSUFBSSxHQUFHLElBQVg7O0FBQ0EsUUFBSSxDQUFDLEtBQUtDLFNBQVYsRUFBcUI7QUFDakIsV0FBS0EsU0FBTCxHQUFpQmYsRUFBRSxDQUFDZ0IscUJBQUgsQ0FBeUI7QUFDdENDLFFBQUFBLFFBQVEsRUFBRTtBQUQ0QixPQUF6QixDQUFqQjtBQUdIOztBQUNELFNBQUtGLFNBQUwsQ0FBZUcsT0FBZixDQUF1QixVQUFBQyxHQUFHLEVBQUksQ0FFN0IsQ0FGRDtBQUlBLFNBQUtKLFNBQUwsQ0FBZUssSUFBZixHQUNLQyxJQURMLENBQ1UsWUFBTTtBQUNSUCxNQUFBQSxJQUFJLENBQUNDLFNBQUwsQ0FBZU8sSUFBZjtBQUNBUixNQUFBQSxJQUFJLENBQUNDLFNBQUwsQ0FBZVEsT0FBZixDQUF1QixVQUFDQyxNQUFELEVBQVk7QUFDL0JWLFFBQUFBLElBQUksQ0FBQ0MsU0FBTCxDQUFlVSxRQUFmOztBQUNBLFlBQUlELE1BQU0sSUFBSUEsTUFBTSxDQUFDRSxPQUFqQixJQUE0QkYsTUFBTSxLQUFLRyxTQUEzQyxFQUFzRDtBQUNsRGIsVUFBQUEsSUFBSSxDQUFDRCxXQUFMLENBQWlCZCxNQUFqQjtBQUNILFNBRkQsTUFFTyxDQUVOO0FBQ0osT0FQRDtBQVFILEtBWEwsV0FZVyxVQUFBb0IsR0FBRztBQUFBLGFBQUl2RCxLQUFLLENBQUNnRSxZQUFOLENBQW1CLGdCQUFuQixFQUFxQyxJQUFyQyxFQUEyQyxJQUEzQyxFQUFpRCxJQUFqRCxFQUF1RCxFQUF2RCxFQUEyRDdELEVBQUUsQ0FBQzhELEtBQUgsQ0FBU0MsS0FBcEUsRUFBMkUsR0FBM0UsQ0FBSjtBQUFBLEtBWmQ7QUFhSCxHQXpGSTtBQTJGTGpCLEVBQUFBLFdBM0ZLLHVCQTJGT2QsTUEzRlAsRUEyRmU7QUFDaEJqQixJQUFBQSxNQUFNLENBQUNpRCxtQkFBUCxDQUEyQkMsSUFBM0IsQ0FBZ0MsS0FBS3pELElBQXJDLEtBQThDLENBQTlDO0FBQ0FYLElBQUFBLEtBQUssQ0FBQ3FFLFdBQU4sQ0FBa0IsQ0FBbEIsRUFBcUIsQ0FBckIsRUFBd0IsSUFBeEIsRUFBOEIsQ0FBOUIsRUFBaUMsQ0FBakM7O0FBQ0EsUUFBSW5ELE1BQU0sQ0FBQ2EsWUFBWCxFQUF5QjtBQUNyQmIsTUFBQUEsTUFBTSxDQUFDYSxZQUFQLENBQW9CdUMsY0FBcEI7QUFDSDtBQUNKLEdBakdJO0FBbUdMbEQsRUFBQUEsVUFuR0ssc0JBbUdNbUQsSUFuR04sRUFtR1k7QUFDYixRQUFJLEtBQUtDLFdBQVQsRUFBc0I7QUFDbEIsVUFBSUQsSUFBSSxJQUFJckQsTUFBTSxDQUFDdUQsVUFBbkIsRUFBK0I7QUFDM0J2RCxRQUFBQSxNQUFNLENBQUNLLFVBQVAsR0FBb0IsSUFBcEI7QUFDQSxhQUFLVCxZQUFMLENBQWtCTyxNQUFsQixHQUEyQkgsTUFBTSxDQUFDSSxTQUFQLElBQW9CLENBQUNKLE1BQU0sQ0FBQ0ssVUFBdkQ7QUFDQSxhQUFLMEIsV0FBTDtBQUNILE9BSkQsTUFJTztBQUNIeUIsc0NBQWtCQyxpQkFBbEI7QUFDSDs7QUFDRCxXQUFLSCxXQUFMLEdBQW1CLEtBQW5CO0FBQ0g7QUFDSixHQTlHSTtBQWdITEksRUFBQUEsVUFoSEssd0JBZ0hRO0FBQ1QsUUFBSTFELE1BQU0sQ0FBQ2lELG1CQUFQLENBQTJCVSxRQUEzQixJQUF1QyxFQUEzQyxFQUErQztBQUMzQztBQUNBN0UsTUFBQUEsS0FBSyxDQUFDcUUsV0FBTixDQUFrQixDQUFsQixFQUFxQixDQUFyQixFQUF3QixJQUF4QixFQUE4QixDQUE5QixFQUFpQyxDQUFqQztBQUNBbkQsTUFBQUEsTUFBTSxDQUFDaUQsbUJBQVAsQ0FBMkJVLFFBQTNCLElBQXVDLEVBQXZDO0FBQ0EzRCxNQUFBQSxNQUFNLENBQUNpRCxtQkFBUCxDQUEyQkMsSUFBM0IsQ0FBZ0MsS0FBS3pELElBQXJDLEtBQThDLENBQTlDOztBQUNBLFVBQUlPLE1BQU0sQ0FBQ2EsWUFBWCxFQUF5QjtBQUNyQmIsUUFBQUEsTUFBTSxDQUFDYSxZQUFQLENBQW9CdUMsY0FBcEI7QUFDSDtBQUNKLEtBUkQsTUFRTztBQUNIdEUsTUFBQUEsS0FBSyxDQUFDZ0UsWUFBTixDQUFtQixNQUFuQixFQUEyQixJQUEzQixFQUFpQyxDQUFqQyxFQUFvQyxDQUFwQyxFQUF1QyxFQUF2QyxFQUEyQzdELEVBQUUsQ0FBQzhELEtBQUgsQ0FBU2EsS0FBcEQ7QUFDSDtBQUNKLEdBNUhJO0FBOEhMQyxFQUFBQSxTQTlISyx1QkE4SE87QUFDUi9ELElBQUFBLGNBQWMsQ0FBQ2dFLEdBQWYsQ0FBbUI5RCxNQUFNLENBQUNDLFlBQTFCLEVBQXdDLElBQXhDOztBQUNBLFFBQUksS0FBS2dDLFNBQVQsRUFBb0I7QUFDaEIsV0FBS0EsU0FBTCxDQUFlOEIsT0FBZjtBQUNBLFdBQUs5QixTQUFMLEdBQWlCLElBQWpCO0FBQ0g7QUFDSixHQXBJSTtBQXNJTCtCLEVBQUFBLFVBdElLLHdCQXNJUTtBQUNULFNBQUtWLFdBQUwsR0FBbUIsSUFBbkI7QUFDQXRFLElBQUFBLFFBQVEsQ0FBQ2lGLGVBQVQsQ0FBeUI7QUFDckI1QyxNQUFBQSxLQUFLLEVBQUUsa0JBRGM7QUFFckI2QyxNQUFBQSxRQUFRLEVBQUVsRSxNQUFNLENBQUNtRSxXQUFQLENBQW1CLENBQW5CO0FBRlcsS0FBekI7QUFJSCxHQTVJSSxDQTZJTDs7QUE3SUssQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbW1vbl9Db21tb25VdGlsIGZyb20gJy4uL2NvbW1vbi9Db21tb25fQ29tbW9uVXRpbCdcbnZhciBVdGlscyA9IHJlcXVpcmUoXCJVdGlsc1wiKTtcbnZhciBTaGFyZVNkayA9IHJlcXVpcmUoJ1NoYXJlU2RrJyk7XG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBtX3NwX3Rvb2w6IGNjLlNwcml0ZSxcbiAgICAgICAgbV9uX2dldDogY2MuTm9kZSxcbiAgICAgICAgX3RhZzogMCxcbiAgICAgICAgbV9zcF9kZXNjbGlzdDogeyB0eXBlOiBjYy5Ob2RlLCBkZWZhdWx0OiBbXSB9LFxuICAgICAgICBtX25fc2hhcmVnZXQ6IGNjLk5vZGUsXG4gICAgfSxcblxuICAgIC8vIExJRkUtQ1lDTEUgQ0FMTEJBQ0tTOlxuXG4gICAgLy8gb25Mb2FkICgpIHt9LFxuXG4gICAgc3RhcnQoKSB7XG4gICAgICAgIEVWRU5UX0xJU1RFTkVSLm9uKHdpbmRvdy5PTl9TSE9XX0JBQ0ssIHRoaXMub25zaG93YmFjaywgdGhpcyk7XG4gICAgICAgIHRoaXMubV9uX3NoYXJlZ2V0LmFjdGl2ZSA9IHdpbmRvdy5CT1hfU0hBUkUgJiYgIXdpbmRvdy5maXJzdHNoYXJlO1xuICAgIH0sXG5cblxuICAgIGluaXRUb29sSW5mbyh0YWcsIG51bSwgc3ApIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2codGFnLCBudW0pXG4gICAgICAgIHRoaXMuX3RhZyA9IHRhZztcbiAgICAgICAgdGhpcy5tX25fZ2V0LmFjdGl2ZSA9IG51bSA8PSAwO1xuICAgIH0sXG5cbiAgICBvbkNsb3NlQ2xpY2soKSB7XG4gICAgICAgIHRoaXMubm9kZS5hY3RpdmUgPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgb25Vc2VDbGljaygpIHtcbiAgICAgICAgaWYgKHRoaXMuX3RhZyA9PSAwKSB7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl90YWcgPT0gMSkge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5HQU1FX0NPTlRST0wpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuR0FNRV9DT05UUk9MLm9uVXNlU3Ryb25nKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkNsb3NlQ2xpY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkFkQnRuQ2xpY2soZXZlbnQsIGN1c3RvbSkge1xuICAgICAgICBpZiAodHlwZW9mICh3eCkgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGxldCBWZXJzaW9uVG9hc3QgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwi5b6u5L+h54mI5pys6L+H5L2O77yM5peg5rOV55yL5bm/5ZGKXCIsXG4gICAgICAgICAgICAgICAgICAgIGljb246IFwibm9uZVwiLFxuICAgICAgICAgICAgICAgICAgICBpbWFnZTogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDAsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB3eC5oaWRlVG9hc3QoKSwgMjAwMCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbGV0IGluZm8gPSB3eC5nZXRTeXN0ZW1JbmZvU3luYygpO1xuICAgICAgICAgICAgaWYgKGluZm8uU0RLVmVyc2lvbiA+PSAnMi4wLjQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93QWQoY3VzdG9tKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgVmVyc2lvblRvYXN0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnaXQgaXMgbm90IHdlY2hhdCcpO1xuICAgICAgICAgICAgdGhpcy52aWRlb1Jld2FyZChjdXN0b20pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNob3dBZChjdXN0b20pIHtcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgICAgICBpZiAoIXRoaXMubV92aWRlb0FkKSB7XG4gICAgICAgICAgICB0aGlzLm1fdmlkZW9BZCA9IHd4LmNyZWF0ZVJld2FyZGVkVmlkZW9BZCh7XG4gICAgICAgICAgICAgICAgYWRVbml0SWQ6ICdhZHVuaXQtZTU3M2U0NjZiZTk0ZDdmNSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubV92aWRlb0FkLm9uRXJyb3IoZXJyID0+IHtcblxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm1fdmlkZW9BZC5sb2FkKClcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICBzZWxmLm1fdmlkZW9BZC5zaG93KCk7XG4gICAgICAgICAgICAgICAgc2VsZi5tX3ZpZGVvQWQub25DbG9zZSgoc3RhdHVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubV92aWRlb0FkLm9mZkNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgJiYgc3RhdHVzLmlzRW5kZWQgfHwgc3RhdHVzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudmlkZW9SZXdhcmQoY3VzdG9tKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBVdGlscy5zaG93VGlwc1RleHQoXCLmi4nljrvop4bpopHlub/lkYrlpLHotKXvvIzor7fnqI3lgJnph43or5VcIiwgbnVsbCwgbnVsbCwgbnVsbCwgNjAsIGNjLkNvbG9yLkJMQUNLLCAxLjIpKTtcbiAgICB9LFxuXG4gICAgdmlkZW9SZXdhcmQoY3VzdG9tKSB7XG4gICAgICAgIHdpbmRvdy5JTklUX0dBTUVfU0FWRV9EQVRBLnRvb2xbdGhpcy5fdGFnXSArPSAxO1xuICAgICAgICBVdGlscy5zaG93R2V0SXRlbSgxLCAwLCBudWxsLCAwLCAwKTtcbiAgICAgICAgaWYgKHdpbmRvdy5HQU1FX0NPTlRST0wpIHtcbiAgICAgICAgICAgIHdpbmRvdy5HQU1FX0NPTlRST0wudXBkYXRlVG9vbHNOdW0oKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbnNob3diYWNrKHRpbWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX29uc2hvd2JhY2spIHtcbiAgICAgICAgICAgIGlmICh0aW1lID49IHdpbmRvdy5TSEFSRV9USU1FKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmZpcnN0c2hhcmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubV9uX3NoYXJlZ2V0LmFjdGl2ZSA9IHdpbmRvdy5CT1hfU0hBUkUgJiYgIXdpbmRvdy5maXJzdHNoYXJlO1xuICAgICAgICAgICAgICAgIHRoaXMudmlkZW9SZXdhcmQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgQ29tbW9uX0NvbW1vblV0aWwuc2hvd1NoYXJlRmFpbFRpcHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX29uc2hvd2JhY2sgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkdldENsaWNrKCkge1xuICAgICAgICBpZiAod2luZG93LklOSVRfR0FNRV9TQVZFX0RBVEEuZ29sZF9udW0gPj0gMjApIHtcbiAgICAgICAgICAgIC8vIFV0aWxzLnNob3dUaXBzVGV4dChcIui0reS5sOaIkOWKn1wiLCBudWxsLCAwLCAwLCA2MCwgY2MuQ29sb3IuV0hJVEUsICk7XG4gICAgICAgICAgICBVdGlscy5zaG93R2V0SXRlbSgxLCAwLCBudWxsLCAwLCAwKTtcbiAgICAgICAgICAgIHdpbmRvdy5JTklUX0dBTUVfU0FWRV9EQVRBLmdvbGRfbnVtIC09IDIwO1xuICAgICAgICAgICAgd2luZG93LklOSVRfR0FNRV9TQVZFX0RBVEEudG9vbFt0aGlzLl90YWddICs9IDE7XG4gICAgICAgICAgICBpZiAod2luZG93LkdBTUVfQ09OVFJPTCkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5HQU1FX0NPTlRST0wudXBkYXRlVG9vbHNOdW0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIFV0aWxzLnNob3dUaXBzVGV4dChcIumHkeW4geS4jei2s1wiLCBudWxsLCAwLCAwLCA2MCwgY2MuQ29sb3IuV0hJVEUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uRGVzdHJveSgpIHtcbiAgICAgICAgRVZFTlRfTElTVEVORVIub2ZmKHdpbmRvdy5PTl9TSE9XX0JBQ0ssIHRoaXMpO1xuICAgICAgICBpZiAodGhpcy5tX3ZpZGVvQWQpIHtcbiAgICAgICAgICAgIHRoaXMubV92aWRlb0FkLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMubV92aWRlb0FkID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvblNoYXJlR2V0KCkge1xuICAgICAgICB0aGlzLl9vbnNob3diYWNrID0gdHJ1ZTtcbiAgICAgICAgU2hhcmVTZGsuc2hhcmVBcHBNZXNzYWdlKHtcbiAgICAgICAgICAgIHRpdGxlOiBcIuW/q+aJtuedgOi/meS4queCuOW8ue+8jOimgeeIhuWVpu+8geimgeeIhuWVpu+8gVwiLFxuICAgICAgICAgICAgaW1hZ2VVcmw6IHdpbmRvdy50ZW1wRmlsZVVSTFszXSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8vIHVwZGF0ZSAoZHQpIHt9LFxufSk7XG4iXX0=