
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/common/GuideManager.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '85665NaV6lFCY6zVqTLmHdP', 'GuideManager');
// Script/common/GuideManager.js

"use strict";

var Utils = require("Utils");

cc.Class({
  "extends": cc.Component,
  properties: {
    m_n_mask: cc.Node,
    m_n_guide_circle: cc.Node,
    m_n_bubble1: cc.Node,
    m_n_bubble2: cc.Node,
    m_n_confirm: cc.Node,
    m_sp_maskbg: cc.Node
  },
  // LIFE-CYCLE CALLBACKS:
  // onLoad () {},
  start: function start() {
    this.node.on(cc.Node.EventType.TOUCH_START, this.touchStart, this);
    this.node.on(cc.Node.EventType.TOUCH_END, this.touchEnd, this);
  },
  showGuide: function showGuide(tag, index) {
    // console.log("window.GUIDE_LEVEL", window.GUIDE_LEVEL);
    if (window.GUIDE_LEVEL >= tag) return; // console.log('shoGuide', tag, index);

    this.m_cur_tag = tag;
    this.m_cur_index = index;

    if (window.CONFIG_GUIDE[tag][index]) {
      this._guide_data = window.CONFIG_GUIDE[tag][index];
      this.setGuideInfo(this._guide_data);
    } else {
      this.node.active = false;
      window.GUIDE_LEVEL += 1;
      cc.sys.localStorage.setItem('guideinfo', '' + window.GUIDE_LEVEL);
      return;
    }

    if (!this.node.active) this.node.active = true;
  },
  touchStart: function touchStart(event) {
    if (this._guide_data.type == 2) {
      event.stopPropagation();
      return;
    } else {
      if (window.GAME_CONTROL) {
        var vec = event.touch.getLocation();
        var index = window.GAME_CONTROL.getTouchIndex(vec);

        if (index != this._guide_data.target) {
          this._confirm = false;
          event.stopPropagation();
          return;
        } else {
          this._confirm = true;
        }
      } else {
        this.node.active = false;
      }
    }
  },
  touchEnd: function touchEnd(event) {
    if (this._guide_data.type != 2) {
      if (this._confirm) {
        this.showNextGuide();
      }
    }

    this._confirm = false;
  },
  showNextGuide: function showNextGuide() {
    var _this = this;

    this._guide_data.target = -2;
    this._guide_data.type = -1;
    setTimeout(function () {
      _this.m_cur_index += 1;

      _this.showGuide(_this.m_cur_tag, _this.m_cur_index);
    }, window.CONFIG_GUIDE[this.m_cur_tag][this.m_cur_index].delaytime);
  },
  onConfirmClick: function onConfirmClick() {
    Utils.SetSoundEffect(window.BUTTON_CLICK_MUSIC, false, 1);
    this.showNextGuide();
  },
  setGuideInfo: function setGuideInfo(data) {
    this.m_n_bubble1.active = data.dir == 1;
    this.m_n_bubble2.active = data.dir == 2;
    var bubblenode = data.dir == 1 ? this.m_n_bubble1 : this.m_n_bubble2;
    var descnode = cc.find("l_guide_desc", bubblenode);
    var dirpos = data.dir == 1 ? -1 : 1;
    descnode.width = data.descsize[0];
    descnode.height = data.descsize[1];
    descnode.getComponent(cc.Label).string = data.desc;
    bubblenode.width = data.descsize[0] + 100;
    bubblenode.height = data.descsize[1] + 50;
    var monnode = cc.find("sp_mon", bubblenode);
    monnode.y = bubblenode.height / 2;

    if (typeof data.target === 'string') {
      //目标点
      var node = cc.find(data.target);
      this.m_n_mask.position = node.position;
      this.m_n_mask.width = node.width + 10;
      this.m_n_mask.height = node.height + 10;
      bubblenode.x = this.m_n_mask.x + dirpos * this.m_n_mask.width / 2;
      bubblenode.y = this.m_n_mask.y + this.m_n_mask.height / 2 + data.offsetY;
      this.m_n_guide_circle.width = this.m_n_mask.width + 30;
      this.m_n_guide_circle.height = this.m_n_mask.height + 30;
      this.m_n_guide_circle.getComponent(cc.Animation).play();
      this.m_n_guide_circle.position = this.m_n_mask.position;
      this.m_sp_maskbg.x = -this.m_n_mask.x;
      this.m_sp_maskbg.y = -this.m_n_mask.y;
    } else if (typeof data.target === 'number') {
      if (data.target == -1) {
        this.m_n_mask.width = 0;
        this.m_n_mask.height = 0;
        this.m_n_guide_circle.width = 0;
        bubblenode.y = 0;
        bubblenode.x = 0;
      } else {
        if (window.GAME_CONTROL) {
          var _node = window.GAME_CONTROL.getTargetGridInfo(data.target);

          this.m_n_mask.position = _node.position;
          this.m_n_mask.width = _node.width + 10;
          this.m_n_mask.height = _node.height + 10;
          bubblenode.x = this.m_n_mask.x + dirpos * this.m_n_mask.width / 2;
          bubblenode.y = this.m_n_mask.y + this.m_n_mask.height / 2 + data.offsetY;
          this.m_n_guide_circle.width = this.m_n_mask.width + 30;
          this.m_n_guide_circle.height = this.m_n_mask.height + 30;
          this.m_n_guide_circle.getComponent(cc.Animation).play();
          this.m_n_guide_circle.position = this.m_n_mask.position;
          this.m_sp_maskbg.x = -this.m_n_mask.x;
          this.m_sp_maskbg.y = -this.m_n_mask.y;
        }
      }
    }

    if (data.type == 2) {
      this.m_n_confirm.active = true;
      this.m_n_confirm.x = bubblenode.x + dirpos * bubblenode.width / 2;
      this.m_n_confirm.y = bubblenode.y - 40;
    } else {
      this.m_n_confirm.active = false;
    }
  } // update (dt) {},

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvY29tbW9uL0d1aWRlTWFuYWdlci5qcyJdLCJuYW1lcyI6WyJVdGlscyIsInJlcXVpcmUiLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsIm1fbl9tYXNrIiwiTm9kZSIsIm1fbl9ndWlkZV9jaXJjbGUiLCJtX25fYnViYmxlMSIsIm1fbl9idWJibGUyIiwibV9uX2NvbmZpcm0iLCJtX3NwX21hc2tiZyIsInN0YXJ0Iiwibm9kZSIsIm9uIiwiRXZlbnRUeXBlIiwiVE9VQ0hfU1RBUlQiLCJ0b3VjaFN0YXJ0IiwiVE9VQ0hfRU5EIiwidG91Y2hFbmQiLCJzaG93R3VpZGUiLCJ0YWciLCJpbmRleCIsIndpbmRvdyIsIkdVSURFX0xFVkVMIiwibV9jdXJfdGFnIiwibV9jdXJfaW5kZXgiLCJDT05GSUdfR1VJREUiLCJfZ3VpZGVfZGF0YSIsInNldEd1aWRlSW5mbyIsImFjdGl2ZSIsInN5cyIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJldmVudCIsInR5cGUiLCJzdG9wUHJvcGFnYXRpb24iLCJHQU1FX0NPTlRST0wiLCJ2ZWMiLCJ0b3VjaCIsImdldExvY2F0aW9uIiwiZ2V0VG91Y2hJbmRleCIsInRhcmdldCIsIl9jb25maXJtIiwic2hvd05leHRHdWlkZSIsInNldFRpbWVvdXQiLCJkZWxheXRpbWUiLCJvbkNvbmZpcm1DbGljayIsIlNldFNvdW5kRWZmZWN0IiwiQlVUVE9OX0NMSUNLX01VU0lDIiwiZGF0YSIsImRpciIsImJ1YmJsZW5vZGUiLCJkZXNjbm9kZSIsImZpbmQiLCJkaXJwb3MiLCJ3aWR0aCIsImRlc2NzaXplIiwiaGVpZ2h0IiwiZ2V0Q29tcG9uZW50IiwiTGFiZWwiLCJzdHJpbmciLCJkZXNjIiwibW9ubm9kZSIsInkiLCJwb3NpdGlvbiIsIngiLCJvZmZzZXRZIiwiQW5pbWF0aW9uIiwicGxheSIsImdldFRhcmdldEdyaWRJbmZvIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztB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RSxTQUF0QyxFQUFpREMsSUFBakQ7QUFDQSxlQUFLOUQsZ0JBQUwsQ0FBc0IwRCxRQUF0QixHQUFpQyxLQUFLNUQsUUFBTCxDQUFjNEQsUUFBL0M7QUFDQSxlQUFLdEQsV0FBTCxDQUFpQnVELENBQWpCLEdBQXFCLENBQUMsS0FBSzdELFFBQUwsQ0FBYzZELENBQXBDO0FBQ0EsZUFBS3ZELFdBQUwsQ0FBaUJxRCxDQUFqQixHQUFxQixDQUFDLEtBQUszRCxRQUFMLENBQWMyRCxDQUFwQztBQUNIO0FBQ0o7QUFDSjs7QUFDRCxRQUFJZCxJQUFJLENBQUNmLElBQUwsSUFBYSxDQUFqQixFQUFvQjtBQUNoQixXQUFLekIsV0FBTCxDQUFpQm9CLE1BQWpCLEdBQTBCLElBQTFCO0FBQ0EsV0FBS3BCLFdBQUwsQ0FBaUJ3RCxDQUFqQixHQUFxQmQsVUFBVSxDQUFDYyxDQUFYLEdBQWVYLE1BQU0sR0FBR0gsVUFBVSxDQUFDSSxLQUFwQixHQUE0QixDQUFoRTtBQUNBLFdBQUs5QyxXQUFMLENBQWlCc0QsQ0FBakIsR0FBcUJaLFVBQVUsQ0FBQ1ksQ0FBWCxHQUFlLEVBQXBDO0FBQ0gsS0FKRCxNQUlPO0FBQ0gsV0FBS3RELFdBQUwsQ0FBaUJvQixNQUFqQixHQUEwQixLQUExQjtBQUNIO0FBQ0osR0E1SUksQ0E2SUw7O0FBN0lLLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBVdGlscyA9IHJlcXVpcmUoXCJVdGlsc1wiKTtcbmNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIG1fbl9tYXNrOiBjYy5Ob2RlLFxuICAgICAgICBtX25fZ3VpZGVfY2lyY2xlOiBjYy5Ob2RlLFxuICAgICAgICBtX25fYnViYmxlMTogY2MuTm9kZSxcbiAgICAgICAgbV9uX2J1YmJsZTI6IGNjLk5vZGUsXG4gICAgICAgIG1fbl9jb25maXJtOiBjYy5Ob2RlLFxuICAgICAgICBtX3NwX21hc2tiZzogY2MuTm9kZSxcbiAgICB9LFxuXG4gICAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XG5cbiAgICAvLyBvbkxvYWQgKCkge30sXG5cbiAgICBzdGFydCgpIHtcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJULCB0aGlzLnRvdWNoU3RhcnQsIHRoaXMpO1xuICAgICAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfRU5ELCB0aGlzLnRvdWNoRW5kLCB0aGlzKTtcbiAgICB9LFxuXG4gICAgc2hvd0d1aWRlKHRhZywgaW5kZXgpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJ3aW5kb3cuR1VJREVfTEVWRUxcIiwgd2luZG93LkdVSURFX0xFVkVMKTtcbiAgICAgICAgaWYgKHdpbmRvdy5HVUlERV9MRVZFTCA+PSB0YWcpIHJldHVybjtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ3Nob0d1aWRlJywgdGFnLCBpbmRleCk7XG4gICAgICAgIHRoaXMubV9jdXJfdGFnID0gdGFnO1xuICAgICAgICB0aGlzLm1fY3VyX2luZGV4ID0gaW5kZXg7XG4gICAgICAgIGlmICh3aW5kb3cuQ09ORklHX0dVSURFW3RhZ11baW5kZXhdKSB7XG4gICAgICAgICAgICB0aGlzLl9ndWlkZV9kYXRhID0gd2luZG93LkNPTkZJR19HVUlERVt0YWddW2luZGV4XTtcbiAgICAgICAgICAgIHRoaXMuc2V0R3VpZGVJbmZvKHRoaXMuX2d1aWRlX2RhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ub2RlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgd2luZG93LkdVSURFX0xFVkVMICs9IDE7XG4gICAgICAgICAgICBjYy5zeXMubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2d1aWRlaW5mbycsICcnICsgd2luZG93LkdVSURFX0xFVkVMKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMubm9kZS5hY3RpdmUpIHRoaXMubm9kZS5hY3RpdmUgPSB0cnVlO1xuICAgIH0sXG5cbiAgICB0b3VjaFN0YXJ0KGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9ndWlkZV9kYXRhLnR5cGUgPT0gMikge1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAod2luZG93LkdBTUVfQ09OVFJPTCkge1xuICAgICAgICAgICAgICAgIGxldCB2ZWMgPSBldmVudC50b3VjaC5nZXRMb2NhdGlvbigpO1xuICAgICAgICAgICAgICAgIGxldCBpbmRleCA9IHdpbmRvdy5HQU1FX0NPTlRST0wuZ2V0VG91Y2hJbmRleCh2ZWMpO1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCAhPSB0aGlzLl9ndWlkZV9kYXRhLnRhcmdldCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb25maXJtID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29uZmlybSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdG91Y2hFbmQoZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2d1aWRlX2RhdGEudHlwZSAhPSAyKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29uZmlybSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd05leHRHdWlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NvbmZpcm0gPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgc2hvd05leHRHdWlkZSgpIHtcbiAgICAgICAgdGhpcy5fZ3VpZGVfZGF0YS50YXJnZXQgPSAtMjtcbiAgICAgICAgdGhpcy5fZ3VpZGVfZGF0YS50eXBlID0gLTE7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5tX2N1cl9pbmRleCArPSAxO1xuICAgICAgICAgICAgdGhpcy5zaG93R3VpZGUodGhpcy5tX2N1cl90YWcsIHRoaXMubV9jdXJfaW5kZXgpO1xuICAgICAgICB9LCB3aW5kb3cuQ09ORklHX0dVSURFW3RoaXMubV9jdXJfdGFnXVt0aGlzLm1fY3VyX2luZGV4XS5kZWxheXRpbWUpO1xuICAgIH0sXG5cbiAgICBvbkNvbmZpcm1DbGljaygpIHtcbiAgICAgICAgVXRpbHMuU2V0U291bmRFZmZlY3Qod2luZG93LkJVVFRPTl9DTElDS19NVVNJQywgZmFsc2UsIDEpO1xuICAgICAgICB0aGlzLnNob3dOZXh0R3VpZGUoKTtcbiAgICB9LFxuXG4gICAgc2V0R3VpZGVJbmZvKGRhdGEpIHtcbiAgICAgICAgdGhpcy5tX25fYnViYmxlMS5hY3RpdmUgPSAoZGF0YS5kaXIgPT0gMSk7XG4gICAgICAgIHRoaXMubV9uX2J1YmJsZTIuYWN0aXZlID0gKGRhdGEuZGlyID09IDIpO1xuICAgICAgICBsZXQgYnViYmxlbm9kZSA9IGRhdGEuZGlyID09IDEgPyB0aGlzLm1fbl9idWJibGUxIDogdGhpcy5tX25fYnViYmxlMjtcbiAgICAgICAgbGV0IGRlc2Nub2RlID0gY2MuZmluZChcImxfZ3VpZGVfZGVzY1wiLCBidWJibGVub2RlKTtcbiAgICAgICAgbGV0IGRpcnBvcyA9IGRhdGEuZGlyID09IDEgPyAtMSA6IDE7XG4gICAgICAgIGRlc2Nub2RlLndpZHRoID0gZGF0YS5kZXNjc2l6ZVswXTtcbiAgICAgICAgZGVzY25vZGUuaGVpZ2h0ID0gZGF0YS5kZXNjc2l6ZVsxXTtcbiAgICAgICAgZGVzY25vZGUuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBkYXRhLmRlc2M7XG4gICAgICAgIGJ1YmJsZW5vZGUud2lkdGggPSBkYXRhLmRlc2NzaXplWzBdICsgMTAwO1xuICAgICAgICBidWJibGVub2RlLmhlaWdodCA9IGRhdGEuZGVzY3NpemVbMV0gKyA1MDtcbiAgICAgICAgbGV0IG1vbm5vZGUgPSBjYy5maW5kKFwic3BfbW9uXCIsIGJ1YmJsZW5vZGUpO1xuICAgICAgICBtb25ub2RlLnkgPSBidWJibGVub2RlLmhlaWdodCAvIDI7XG4gICAgICAgIGlmICh0eXBlb2YgKGRhdGEudGFyZ2V0KSA9PT0gJ3N0cmluZycpIHsvL+ebruagh+eCuVxuICAgICAgICAgICAgbGV0IG5vZGUgPSBjYy5maW5kKGRhdGEudGFyZ2V0KTtcbiAgICAgICAgICAgIHRoaXMubV9uX21hc2sucG9zaXRpb24gPSBub2RlLnBvc2l0aW9uO1xuICAgICAgICAgICAgdGhpcy5tX25fbWFzay53aWR0aCA9IG5vZGUud2lkdGggKyAxMDtcbiAgICAgICAgICAgIHRoaXMubV9uX21hc2suaGVpZ2h0ID0gbm9kZS5oZWlnaHQgKyAxMDtcbiAgICAgICAgICAgIGJ1YmJsZW5vZGUueCA9IHRoaXMubV9uX21hc2sueCArIGRpcnBvcyAqIHRoaXMubV9uX21hc2sud2lkdGggLyAyO1xuICAgICAgICAgICAgYnViYmxlbm9kZS55ID0gdGhpcy5tX25fbWFzay55ICsgdGhpcy5tX25fbWFzay5oZWlnaHQgLyAyICsgZGF0YS5vZmZzZXRZO1xuICAgICAgICAgICAgdGhpcy5tX25fZ3VpZGVfY2lyY2xlLndpZHRoID0gdGhpcy5tX25fbWFzay53aWR0aCArIDMwO1xuICAgICAgICAgICAgdGhpcy5tX25fZ3VpZGVfY2lyY2xlLmhlaWdodCA9IHRoaXMubV9uX21hc2suaGVpZ2h0ICsgMzA7XG4gICAgICAgICAgICB0aGlzLm1fbl9ndWlkZV9jaXJjbGUuZ2V0Q29tcG9uZW50KGNjLkFuaW1hdGlvbikucGxheSgpO1xuICAgICAgICAgICAgdGhpcy5tX25fZ3VpZGVfY2lyY2xlLnBvc2l0aW9uID0gdGhpcy5tX25fbWFzay5wb3NpdGlvbjtcbiAgICAgICAgICAgIHRoaXMubV9zcF9tYXNrYmcueCA9IC10aGlzLm1fbl9tYXNrLng7XG4gICAgICAgICAgICB0aGlzLm1fc3BfbWFza2JnLnkgPSAtdGhpcy5tX25fbWFzay55O1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiAoZGF0YS50YXJnZXQpID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgaWYgKGRhdGEudGFyZ2V0ID09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tX25fbWFzay53aWR0aCA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5tX25fbWFzay5oZWlnaHQgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMubV9uX2d1aWRlX2NpcmNsZS53aWR0aCA9IDA7XG4gICAgICAgICAgICAgICAgYnViYmxlbm9kZS55ID0gMDtcbiAgICAgICAgICAgICAgICBidWJibGVub2RlLnggPSAwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LkdBTUVfQ09OVFJPTCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbm9kZSA9IHdpbmRvdy5HQU1FX0NPTlRST0wuZ2V0VGFyZ2V0R3JpZEluZm8oZGF0YS50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1fbl9tYXNrLnBvc2l0aW9uID0gbm9kZS5wb3NpdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tX25fbWFzay53aWR0aCA9IG5vZGUud2lkdGggKyAxMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tX25fbWFzay5oZWlnaHQgPSBub2RlLmhlaWdodCArIDEwO1xuICAgICAgICAgICAgICAgICAgICBidWJibGVub2RlLnggPSB0aGlzLm1fbl9tYXNrLnggKyBkaXJwb3MgKiB0aGlzLm1fbl9tYXNrLndpZHRoIC8gMjtcbiAgICAgICAgICAgICAgICAgICAgYnViYmxlbm9kZS55ID0gdGhpcy5tX25fbWFzay55ICsgdGhpcy5tX25fbWFzay5oZWlnaHQgLyAyICsgZGF0YS5vZmZzZXRZO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1fbl9ndWlkZV9jaXJjbGUud2lkdGggPSB0aGlzLm1fbl9tYXNrLndpZHRoICsgMzA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubV9uX2d1aWRlX2NpcmNsZS5oZWlnaHQgPSB0aGlzLm1fbl9tYXNrLmhlaWdodCArIDMwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1fbl9ndWlkZV9jaXJjbGUuZ2V0Q29tcG9uZW50KGNjLkFuaW1hdGlvbikucGxheSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1fbl9ndWlkZV9jaXJjbGUucG9zaXRpb24gPSB0aGlzLm1fbl9tYXNrLnBvc2l0aW9uO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1fc3BfbWFza2JnLnggPSAtdGhpcy5tX25fbWFzay54O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1fc3BfbWFza2JnLnkgPSAtdGhpcy5tX25fbWFzay55O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YS50eXBlID09IDIpIHtcbiAgICAgICAgICAgIHRoaXMubV9uX2NvbmZpcm0uYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubV9uX2NvbmZpcm0ueCA9IGJ1YmJsZW5vZGUueCArIGRpcnBvcyAqIGJ1YmJsZW5vZGUud2lkdGggLyAyO1xuICAgICAgICAgICAgdGhpcy5tX25fY29uZmlybS55ID0gYnViYmxlbm9kZS55IC0gNDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm1fbl9jb25maXJtLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvLyB1cGRhdGUgKGR0KSB7fSxcbn0pO1xuIl19